<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Admin Panel - LENG</title>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --primary: #6366f1;
            --primary-dark: #4f46e5;
            --secondary: #8b5cf6;
            --accent: #06b6d4;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --dark: #0f172a;
            --dark-light: #1e293b;
            --gray: #64748b;
            --gray-light: #94a3b8;
            --light: #f1f5f9;
            --white: #ffffff;
            --card-bg: rgba(30, 41, 59, 0.9);
            --glass: rgba(255, 255, 255, 0.1);
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background: linear-gradient(135deg, var(--dark) 0%, #1a1a2e 50%, var(--dark) 100%);
            min-height: 100vh;
            color: var(--white);
        }

        /* Login Screen */
        .login-container {
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .login-box {
            background: var(--card-bg);
            backdrop-filter: blur(20px);
            border-radius: 24px;
            padding: 40px;
            width: 100%;
            max-width: 420px;
            border: 1px solid var(--glass);
        }

        .login-logo {
            text-align: center;
            margin-bottom: 32px;
        }

        .login-logo i {
            font-size: 48px;
            color: var(--danger);
        }

        .login-logo h1 {
            font-size: 24px;
            font-weight: 700;
            margin-top: 12px;
        }

        .login-logo p {
            color: var(--gray-light);
            font-size: 14px;
            margin-top: 4px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-size: 14px;
            font-weight: 500;
            color: var(--gray-light);
        }

        .form-group input, .form-group select, .form-group textarea {
            width: 100%;
            padding: 14px 16px;
            background: var(--dark);
            border: 1px solid var(--glass);
            border-radius: 12px;
            color: var(--white);
            font-size: 15px;
            transition: all 0.3s ease;
        }

        .form-group input:focus, .form-group select:focus, .form-group textarea:focus {
            outline: none;
            border-color: var(--primary);
            box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.2);
        }

        .btn {
            padding: 14px 24px;
            border: none;
            border-radius: 12px;
            font-size: 15px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--primary), var(--secondary));
            color: var(--white);
            width: 100%;
        }

        .btn-google {
            background: var(--white);
            color: #333;
            border: 1px solid var(--glass);
            width: 100%;
            margin-top: 16px;
        }

        .btn-google:hover {
            background: var(--light);
        }

        .btn-google img {
            width: 20px;
            height: 20px;
        }

        .btn-success {
            background: linear-gradient(135deg, var(--success), #059669);
            color: var(--white);
        }

        .btn-danger {
            background: linear-gradient(135deg, var(--danger), #dc2626);
            color: var(--white);
        }

        .btn-warning {
            background: linear-gradient(135deg, var(--warning), #d97706);
            color: var(--white);
        }

        .btn-secondary {
            background: var(--dark-light);
            color: var(--white);
            border: 1px solid var(--glass);
        }

        .btn-small {
            padding: 8px 16px;
            font-size: 13px;
        }

        .btn:hover {
            transform: translateY(-2px);
        }

        .divider {
            display: flex;
            align-items: center;
            margin: 20px 0;
            color: var(--gray);
            font-size: 14px;
        }

        .divider::before,
        .divider::after {
            content: '';
            flex: 1;
            height: 1px;
            background: var(--glass);
        }

        .divider span {
            padding: 0 16px;
        }

        /* Admin Layout */
        .admin-container {
            display: none;
            min-height: 100vh;
        }

        .admin-header {
            background: var(--card-bg);
            backdrop-filter: blur(20px);
            padding: 16px 24px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            border-bottom: 1px solid var(--glass);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .admin-logo {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .admin-logo i {
            font-size: 24px;
            color: var(--danger);
        }

        .admin-logo span {
            font-size: 18px;
            font-weight: 700;
        }

        .admin-user {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .admin-user img {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
        }

        .admin-body {
            display: flex;
            min-height: calc(100vh - 73px);
        }

        /* Sidebar */
        .admin-sidebar {
            width: 260px;
            background: var(--card-bg);
            border-right: 1px solid var(--glass);
            padding: 20px 0;
            flex-shrink: 0;
        }

        @media (max-width: 1024px) {
            .admin-sidebar {
                position: fixed;
                left: -260px;
                top: 73px;
                height: calc(100vh - 73px);
                z-index: 99;
                transition: left 0.3s ease;
            }

            .admin-sidebar.open {
                left: 0;
            }

            .sidebar-overlay {
                display: none;
                position: fixed;
                top: 73px;
                left: 0;
                right: 0;
                bottom: 0;
                background: rgba(0,0,0,0.5);
                z-index: 98;
            }

            .sidebar-overlay.show {
                display: block;
            }
        }

        .sidebar-menu {
            list-style: none;
        }

        .sidebar-item {
            padding: 12px 24px;
            display: flex;
            align-items: center;
            gap: 12px;
            color: var(--gray-light);
            cursor: pointer;
            transition: all 0.3s ease;
            border-left: 3px solid transparent;
        }

        .sidebar-item:hover {
            background: var(--dark);
            color: var(--white);
        }

        .sidebar-item.active {
            background: rgba(99, 102, 241, 0.1);
            color: var(--primary);
            border-left-color: var(--primary);
        }

        .sidebar-item i {
            width: 20px;
        }

        .sidebar-badge {
            margin-left: auto;
            background: var(--danger);
            color: var(--white);
            padding: 2px 8px;
            border-radius: 10px;
            font-size: 11px;
            font-weight: 600;
        }

        /* Content Area */
        .admin-content {
            flex: 1;
            padding: 24px;
            overflow-y: auto;
        }

        @media (max-width: 768px) {
            .admin-content {
                padding: 16px;
            }
        }

        .content-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 24px;
            flex-wrap: wrap;
            gap: 16px;
        }

        .content-title {
            font-size: 24px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .content-title i {
            color: var(--primary);
        }

        /* Stats Cards */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-bottom: 24px;
        }

        .stat-card {
            background: var(--card-bg);
            border-radius: 16px;
            padding: 20px;
            border: 1px solid var(--glass);
        }

        .stat-card-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 12px;
        }

        .stat-icon {
            width: 48px;
            height: 48px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 20px;
        }

        .stat-icon.primary {
            background: rgba(99, 102, 241, 0.2);
            color: var(--primary);
        }

        .stat-icon.success {
            background: rgba(16, 185, 129, 0.2);
            color: var(--success);
        }

        .stat-icon.warning {
            background: rgba(245, 158, 11, 0.2);
            color: var(--warning);
        }

        .stat-icon.danger {
            background: rgba(239, 68, 68, 0.2);
            color: var(--danger);
        }

        .stat-icon.secondary {
            background: rgba(139, 92, 246, 0.2);
            color: var(--secondary);
        }

        .stat-value {
            font-size: 32px;
            font-weight: 700;
        }

        .stat-label {
            font-size: 14px;
            color: var(--gray-light);
        }

        /* Data Table */
        .data-card {
            background: var(--card-bg);
            border-radius: 16px;
            border: 1px solid var(--glass);
            overflow: hidden;
            margin-bottom: 24px;
        }

        .data-card-header {
            padding: 20px;
            border-bottom: 1px solid var(--glass);
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 12px;
        }

        .data-card-title {
            font-size: 18px;
            font-weight: 600;
        }

        .data-card-actions {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
        }

        .search-input {
            padding: 10px 16px;
            background: var(--dark);
            border: 1px solid var(--glass);
            border-radius: 10px;
            color: var(--white);
            font-size: 14px;
            width: 200px;
        }

        .search-input:focus {
            outline: none;
            border-color: var(--primary);
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
        }

        .data-table th,
        .data-table td {
            padding: 16px 20px;
            text-align: left;
            border-bottom: 1px solid var(--glass);
        }

        .data-table th {
            background: var(--dark);
            font-weight: 600;
            font-size: 13px;
            text-transform: uppercase;
            color: var(--gray-light);
        }

        .data-table tr:hover {
            background: rgba(99, 102, 241, 0.05);
        }

        .data-table img {
            width: 40px;
            height: 40px;
            border-radius: 8px;
            object-fit: cover;
        }

        /* Mobile Table */
        @media (max-width: 768px) {
            .data-table thead {
                display: none;
            }

            .data-table tr {
                display: block;
                margin-bottom: 16px;
                background: var(--dark);
                border-radius: 12px;
                padding: 16px;
            }

            .data-table td {
                display: flex;
                justify-content: space-between;
                align-items: center;
                padding: 8px 0;
                border-bottom: 1px solid var(--glass);
            }

            .data-table td:last-child {
                border-bottom: none;
            }

            .data-table td::before {
                content: attr(data-label);
                font-weight: 600;
                color: var(--gray-light);
                font-size: 12px;
                text-transform: uppercase;
            }
        }

        /* User Item */
        .user-item {
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .user-item img {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
        }

        .user-item-info {
            display: flex;
            flex-direction: column;
        }

        .user-item-name {
            font-weight: 500;
        }

        .user-item-email {
            font-size: 12px;
            color: var(--gray-light);
        }

        /* Status Badge */
        .status-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
        }

        .status-badge.active {
            background: rgba(16, 185, 129, 0.2);
            color: var(--success);
        }

        .status-badge.pending {
            background: rgba(245, 158, 11, 0.2);
            color: var(--warning);
        }

        .status-badge.inactive {
            background: rgba(239, 68, 68, 0.2);
            color: var(--danger);
        }

        /* Action Buttons */
        .action-btns {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .action-btn {
            width: 36px;
            height: 36px;
            border-radius: 8px;
            border: none;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s ease;
        }

        .action-btn.edit {
            background: rgba(99, 102, 241, 0.2);
            color: var(--primary);
        }

        .action-btn.delete {
            background: rgba(239, 68, 68, 0.2);
            color: var(--danger);
        }

        .action-btn.view {
            background: rgba(6, 182, 212, 0.2);
            color: var(--accent);
        }

        .action-btn.approve {
            background: rgba(16, 185, 129, 0.2);
            color: var(--success);
        }

        .action-btn:hover {
            transform: scale(1.1);
        }

        /* Modal */
        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            backdrop-filter: blur(5px);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal {
            background: var(--dark-light);
            border-radius: 20px;
            width: 100%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            border: 1px solid var(--glass);
        }

        .modal-header {
            padding: 20px;
            border-bottom: 1px solid var(--glass);
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .modal-title {
            font-size: 18px;
            font-weight: 600;
        }

        .modal-close {
            width: 36px;
            height: 36px;
            background: var(--dark);
            border: none;
            border-radius: 10px;
            color: var(--white);
            cursor: pointer;
        }

        .modal-body {
            padding: 20px;
        }

        .modal-footer {
            padding: 20px;
            border-top: 1px solid var(--glass);
            display: flex;
            gap: 12px;
            justify-content: flex-end;
        }

        /* Image Upload */
        .image-upload-container {
            position: relative;
            width: 100%;
            height: 150px;
            background: var(--dark);
            border: 2px dashed var(--glass);
            border-radius: 12px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            overflow: hidden;
            transition: all 0.3s ease;
        }

        .image-upload-container:hover {
            border-color: var(--primary);
        }

        .image-upload-container i {
            font-size: 32px;
            color: var(--gray);
            margin-bottom: 8px;
        }

        .image-upload-container span {
            font-size: 14px;
            color: var(--gray);
        }

        .image-upload-preview {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        /* Tabs */
        .tabs {
            display: flex;
            gap: 8px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }

        .tab {
            padding: 10px 20px;
            background: var(--dark);
            border: 1px solid var(--glass);
            border-radius: 10px;
            color: var(--gray-light);
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .tab:hover {
            border-color: var(--primary);
        }

        .tab.active {
            background: var(--primary);
            color: var(--white);
            border-color: var(--primary);
        }

        /* Club Item */
        .club-item {
            display: flex;
            align-items: center;
            gap: 16px;
            padding: 16px;
            background: var(--dark);
            border-radius: 12px;
            margin-bottom: 12px;
        }

        .club-item img {
            width: 60px;
            height: 60px;
            border-radius: 12px;
            object-fit: cover;
        }

        .club-item-info {
            flex: 1;
        }

        .club-item-name {
            font-weight: 600;
            margin-bottom: 4px;
        }

        .club-item-stats {
            font-size: 13px;
            color: var(--gray-light);
        }

        .club-item-actions {
            display: flex;
            gap: 8px;
        }

        /* Question Item */
        .question-card {
            background: var(--dark);
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 12px;
        }

        .question-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 12px;
        }

        .question-header img {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
        }

        .question-user {
            font-weight: 600;
        }

        .question-event {
            font-size: 12px;
            color: var(--primary);
        }

        .question-text {
            font-size: 14px;
            color: var(--gray-light);
            margin-bottom: 12px;
            line-height: 1.5;
        }

        .question-answer-input {
            display: flex;
            gap: 12px;
        }

        .question-answer-input input {
            flex: 1;
            padding: 10px 16px;
            background: var(--dark-light);
            border: 1px solid var(--glass);
            border-radius: 10px;
            color: var(--white);
            font-size: 14px;
        }

        .question-answer-input input:focus {
            outline: none;
            border-color: var(--primary);
        }

        /* Page Sections */
        .page-section {
            display: none;
        }

        .page-section.active {
            display: block;
        }

        /* Toast */
        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 2000;
        }

        .toast {
            padding: 16px 20px;
            background: var(--dark-light);
            border-radius: 12px;
            border: 1px solid var(--glass);
            margin-bottom: 12px;
            animation: slideIn 0.3s ease;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        @keyframes slideIn {
            from {
                opacity: 0;
                transform: translateX(100px);
            }
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        .toast.success {
            border-left: 4px solid var(--success);
        }

        .toast.error {
            border-left: 4px solid var(--danger);
        }

        .toast.info {
            border-left: 4px solid var(--primary);
        }

        /* Mobile Menu Button */
        .mobile-menu-btn {
            display: none;
            width: 40px;
            height: 40px;
            background: var(--dark);
            border: 1px solid var(--glass);
            border-radius: 10px;
            color: var(--white);
            cursor: pointer;
        }

        @media (max-width: 1024px) {
            .mobile-menu-btn {
                display: flex;
                align-items: center;
                justify-content: center;
            }
        }

        /* Empty State */
        .empty-state {
            text-align: center;
            padding: 60px 24px;
        }

        .empty-state i {
            font-size: 48px;
            color: var(--gray);
            margin-bottom: 16px;
        }

        .empty-state h3 {
            font-size: 18px;
            color: var(--gray-light);
            margin-bottom: 8px;
        }

        .empty-state p {
            font-size: 14px;
            color: var(--gray);
        }

        /* Hidden class */
        .hidden {
            display: none !important;
        }
    </style>
</head>
<body>
    <!-- Login Container -->
    <div class="login-container" id="loginContainer">
        <div class="login-box">
            <div class="login-logo">
                <i class="fas fa-shield-alt"></i>
                <h1>LENG Admin</h1>
                <p>Admin paneline erisim</p>
            </div>

            <form onsubmit="handleAdminLogin(event)">
                <div class="form-group">
                    <label>E-posta</label>
                    <input type="email" id="adminEmail" placeholder="admin@example.com" required>
                </div>
                <div class="form-group">
                    <label>Sifre</label>
                    <input type="password" id="adminPassword" placeholder="Sifrenizi girin" required>
                </div>
                <button type="submit" class="btn btn-primary">
                    <i class="fas fa-sign-in-alt"></i>
                    Giris Yap
                </button>
            </form>

            <div class="divider">
                <span>veya</span>
            </div>

            <button class="btn btn-google" onclick="handleGoogleAdminLogin()">
                <img src="https://www.gstatic.com/firebasejs/ui/2.0.0/images/auth/google.svg" alt="Google">
                Google ile Giris Yap
            </button>
        </div>
    </div>

    <!-- Admin Container -->
    <div class="admin-container" id="adminContainer">
        <!-- Header -->
        <header class="admin-header">
            <div class="admin-logo">
                <button class="mobile-menu-btn" onclick="toggleSidebar()">
                    <i class="fas fa-bars"></i>
                </button>
                <i class="fas fa-shield-alt"></i>
                <span>LENG Admin</span>
            </div>
            <div class="admin-user">
                <span id="adminName">Admin</span>
                <button class="btn btn-small btn-danger" onclick="handleLogout()">
                    <i class="fas fa-sign-out-alt"></i>
                    Cikis
                </button>
            </div>
        </header>

        <div class="admin-body">
            <!-- Sidebar Overlay -->
            <div class="sidebar-overlay" id="sidebarOverlay" onclick="toggleSidebar()"></div>

            <!-- Sidebar -->
            <aside class="admin-sidebar" id="adminSidebar">
                <ul class="sidebar-menu">
                    <li class="sidebar-item active" onclick="switchSection('dashboard')">
                        <i class="fas fa-home"></i>
                        <span>Dashboard</span>
                    </li>
                    <li class="sidebar-item" onclick="switchSection('users')">
                        <i class="fas fa-users"></i>
                        <span>Kullanicilar</span>
                    </li>
                    <li class="sidebar-item" onclick="switchSection('events')">
                        <i class="fas fa-calendar-alt"></i>
                        <span>Etkinlikler</span>
                    </li>
                    <li class="sidebar-item" onclick="switchSection('clubs')">
                        <i class="fas fa-users-cog"></i>
                        <span>Kulupler</span>
                    </li>
                    <li class="sidebar-item" onclick="switchSection('creators')">
                        <i class="fas fa-user-check"></i>
                        <span>Kulup Izinleri</span>
                    </li>
                    <li class="sidebar-item" onclick="switchSection('questions')">
                        <i class="fas fa-question-circle"></i>
                        <span>Sorular</span>
                        <span class="sidebar-badge hidden" id="questionsBadge">0</span>
                    </li>
                    <li class="sidebar-item" onclick="switchSection('notifications')">
                        <i class="fas fa-bell"></i>
                        <span>Bildirimler</span>
                    </li>
                </ul>
            </aside>

            <!-- Main Content -->
            <main class="admin-content">
                <!-- Dashboard Section -->
                <section class="page-section active" id="section-dashboard">
                    <div class="content-header">
                        <h1 class="content-title"><i class="fas fa-chart-line"></i> Dashboard</h1>
                    </div>

                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-card-header">
                                <div class="stat-icon primary">
                                    <i class="fas fa-users"></i>
                                </div>
                            </div>
                            <div class="stat-value" id="statUsers">0</div>
                            <div class="stat-label">Toplam Kullanici</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-card-header">
                                <div class="stat-icon success">
                                    <i class="fas fa-calendar-check"></i>
                                </div>
                            </div>
                            <div class="stat-value" id="statEvents">0</div>
                            <div class="stat-label">Toplam Etkinlik</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-card-header">
                                <div class="stat-icon warning">
                                    <i class="fas fa-users-cog"></i>
                                </div>
                            </div>
                            <div class="stat-value" id="statClubs">0</div>
                            <div class="stat-label">Toplam Kulup</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-card-header">
                                <div class="stat-icon danger">
                                    <i class="fas fa-question-circle"></i>
                                </div>
                            </div>
                            <div class="stat-value" id="statQuestions">0</div>
                            <div class="stat-label">Bekleyen Soru</div>
                        </div>
                    </div>

                    <div class="data-card">
                        <div class="data-card-header">
                            <h3 class="data-card-title">Son Kayit Olan Kullanicilar</h3>
                        </div>
                        <div id="recentUsersContainer" style="padding: 20px;"></div>
                    </div>
                </section>

                <!-- Users Section -->
                <section class="page-section" id="section-users">
                    <div class="content-header">
                        <h1 class="content-title"><i class="fas fa-users"></i> Kullanicilar</h1>
                    </div>

                    <div class="data-card">
                        <div class="data-card-header">
                            <h3 class="data-card-title">Tum Kullanicilar</h3>
                            <input type="text" class="search-input" placeholder="Kullanici ara..." id="userSearchInput" oninput="filterUsers()">
                        </div>
                        <div style="overflow-x: auto;">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Kullanici</th>
                                        <th>Bolum</th>
                                        <th>Kulup Olusturma</th>
                                        <th>Kayit Tarihi</th>
                                        <th>Islemler</th>
                                    </tr>
                                </thead>
                                <tbody id="usersTableBody"></tbody>
                            </table>
                        </div>
                    </div>
                </section>

                <!-- Events Section -->
                <section class="page-section" id="section-events">
                    <div class="content-header">
                        <h1 class="content-title"><i class="fas fa-calendar-alt"></i> Etkinlikler</h1>
                        <button class="btn btn-primary btn-small" onclick="openEventModal()">
                            <i class="fas fa-plus"></i>
                            Yeni Etkinlik
                        </button>
                    </div>

                    <div class="data-card">
                        <div class="data-card-header">
                            <h3 class="data-card-title">Tum Etkinlikler</h3>
                        </div>
                        <div style="overflow-x: auto;">
                            <table class="data-table">
                                <thead>
                                    <tr>
                                        <th>Gorsel</th>
                                        <th>Baslik</th>
                                        <th>Tarih</th>
                                        <th>Konum</th>
                                        <th>Katilimci</th>
                                        <th>Islemler</th>
                                    </tr>
                                </thead>
                                <tbody id="eventsTableBody"></tbody>
                            </table>
                        </div>
                    </div>
                </section>

                <!-- Clubs Section -->
                <section class="page-section" id="section-clubs">
                    <div class="content-header">
                        <h1 class="content-title"><i class="fas fa-users-cog"></i> Kulupler</h1>
                    </div>

                    <div class="tabs">
                        <button class="tab active" onclick="switchClubTab('all')">Tum Kulupler</button>
                        <button class="tab" onclick="switchClubTab('badges')">Rozetler</button>
                    </div>

                    <!-- All Clubs -->
                    <div id="clubsTab-all">
                        <div class="data-card">
                            <div class="data-card-header">
                                <h3 class="data-card-title">Kulup Listesi</h3>
                                <input type="text" class="search-input" placeholder="Kulup ara..." id="clubSearchInput" oninput="filterClubs()">
                            </div>
                            <div id="clubsListContainer" style="padding: 20px;"></div>
                        </div>
                    </div>

                    <!-- Badges -->
                    <div id="clubsTab-badges" style="display: none;">
                        <div class="data-card">
                            <div class="data-card-header">
                                <h3 class="data-card-title">Kulup Rozetleri</h3>
                            </div>
                            <div id="badgesListContainer" style="padding: 20px;"></div>
                        </div>
                    </div>
                </section>

                <!-- Club Creators Section -->
                <section class="page-section" id="section-creators">
                    <div class="content-header">
                        <h1 class="content-title"><i class="fas fa-user-check"></i> Kulup Olusturma Izinleri</h1>
                    </div>

                    <div class="tabs">
                        <button class="tab active" onclick="switchCreatorTab('approved')">Onaylilar</button>
                        <button class="tab" onclick="switchCreatorTab('pending')">Bekleyenler</button>
                        <button class="tab" onclick="switchCreatorTab('all')">Tum Kullanicilar</button>
                    </div>

                    <!-- Approved Creators -->
                    <div id="creatorsTab-approved">
                        <div class="data-card">
                            <div class="data-card-header">
                                <h3 class="data-card-title">Kulup Olusturma Yetkisi Olanlar</h3>
                            </div>
                            <div id="approvedCreatorsContainer" style="padding: 20px;"></div>
                        </div>
                    </div>

                    <!-- Pending Requests -->
                    <div id="creatorsTab-pending" style="display: none;">
                        <div class="data-card">
                            <div class="data-card-header">
                                <h3 class="data-card-title">Bekleyen Talepler</h3>
                            </div>
                            <div id="pendingCreatorsContainer" style="padding: 20px;"></div>
                        </div>
                    </div>

                    <!-- All Users -->
                    <div id="creatorsTab-all" style="display: none;">
                        <div class="data-card">
                            <div class="data-card-header">
                                <h3 class="data-card-title">Tum Kullanicilar</h3>
                                <input type="text" class="search-input" placeholder="Kullanici ara..." id="creatorSearchInput" oninput="filterCreators()">
                            </div>
                            <div id="allCreatorsContainer" style="padding: 20px;"></div>
                        </div>
                    </div>
                </section>

                <!-- Questions Section -->
                <section class="page-section" id="section-questions">
                    <div class="content-header">
                        <h1 class="content-title"><i class="fas fa-question-circle"></i> Etkinlik Sorulari</h1>
                    </div>

                    <div class="tabs">
                        <button class="tab active" onclick="switchQuestionTab('unanswered')">Cevaplanmamis</button>
                        <button class="tab" onclick="switchQuestionTab('answered')">Cevaplanan</button>
                    </div>

                    <div id="questionsTab-unanswered">
                        <div id="unansweredQuestionsContainer"></div>
                    </div>

                    <div id="questionsTab-answered" style="display: none;">
                        <div id="answeredQuestionsContainer"></div>
                    </div>
                </section>

                <!-- Notifications Section -->
                <section class="page-section" id="section-notifications">
                    <div class="content-header">
                        <h1 class="content-title"><i class="fas fa-bell"></i> Bildirim Gonder</h1>
                    </div>

                    <div class="data-card">
                        <div class="data-card-header">
                            <h3 class="data-card-title">Toplu Bildirim</h3>
                        </div>
                        <div style="padding: 20px;">
                            <div class="form-group">
                                <label>Bildirim Basligi</label>
                                <input type="text" id="notificationTitle" placeholder="Bildirim basligi">
                            </div>
                            <div class="form-group">
                                <label>Bildirim Mesaji</label>
                                <textarea id="notificationMessage" rows="4" placeholder="Bildirim mesaji"></textarea>
                            </div>
                            <div class="form-group">
                                <label>Hedef Kitle</label>
                                <select id="notificationTarget">
                                    <option value="all">Tum Kullanicilar</option>
                                    <option value="clubOwners">Kulup Sahipleri</option>
                                    <option value="eventParticipants">Etkinlik Katilimcilari</option>
                                </select>
                            </div>
                            <button class="btn btn-primary" onclick="sendMassNotification()">
                                <i class="fas fa-paper-plane"></i>
                                Bildirim Gonder
                            </button>
                        </div>
                    </div>
                </section>
            </main>
        </div>
    </div>

    <!-- Event Modal -->
    <div class="modal-overlay" id="eventModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title" id="eventModalTitle">Yeni Etkinlik</h3>
                <button class="modal-close" onclick="closeEventModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="form-group">
                    <label>Etkinlik Gorseli</label>
                    <div class="image-upload-container" onclick="document.getElementById('eventImageInput').click()">
                        <i class="fas fa-image"></i>
                        <span>Gorsel Yukle</span>
                        <img src="" alt="" class="image-upload-preview hidden" id="eventImagePreview">
                        <input type="file" id="eventImageInput" accept="image/*" style="display: none;" onchange="previewEventImage(event)">
                    </div>
                </div>
                <div class="form-group">
                    <label>Etkinlik Adi</label>
                    <input type="text" id="eventTitle" placeholder="Etkinlik adini girin">
                </div>
                <div class="form-group">
                    <label>Aciklama</label>
                    <textarea id="eventDescription" rows="4" placeholder="Etkinlik aciklamasi"></textarea>
                </div>
                <div class="form-group">
                    <label>Tarih</label>
                    <input type="date" id="eventDate">
                </div>
                <div class="form-group">
                    <label>Saat</label>
                    <input type="time" id="eventTime">
                </div>
                <div class="form-group">
                    <label>Konum</label>
                    <input type="text" id="eventLocation" placeholder="Etkinlik konumu">
                </div>
                <div class="form-group">
                    <label>Organizator</label>
                    <input type="text" id="eventOrganizer" placeholder="Organizator adi">
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" onclick="closeEventModal()">Iptal</button>
                <button class="btn btn-primary" onclick="saveEvent()">Kaydet</button>
            </div>
        </div>
    </div>

    <!-- Club Detail Modal -->
    <div class="modal-overlay" id="clubDetailModal">
        <div class="modal">
            <div class="modal-header">
                <h3 class="modal-title">Kulup Detaylari</h3>
                <button class="modal-close" onclick="closeClubDetailModal()">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body" id="clubDetailContent"></div>
            <div class="modal-footer">
                <button class="btn btn-danger" onclick="deleteCurrentClub()">
                    <i class="fas fa-trash"></i>
                    Kulubu Sil
                </button>
                <button class="btn btn-secondary" onclick="closeClubDetailModal()">Kapat</button>
            </div>
        </div>
    </div>

    <!-- Toast Container -->
    <div class="toast-container" id="toastContainer"></div>

    <!-- Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-storage-compat.js"></script>

    <script>
        // Firebase Configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBKbL4aS1U7BPnff8L4w6dUFDgjkBhOIks",
            authDomain: "event-dcf0f.firebaseapp.com",
            databaseURL: "https://event-dcf0f-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "event-dcf0f",
            storageBucket: "event-dcf0f.firebasestorage.app",
            messagingSenderId: "798433104",
            appId: "1:798433104:web:ae16ae41afeae4cdb2c8ef",
            measurementId: "G-G0CHQJ5X8W"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const db = firebase.database();
        const storage = firebase.storage();
        const googleProvider = new firebase.auth.GoogleAuthProvider();

        // Global State
        let currentAdmin = null;
        let allUsers = [];
        let allEvents = [];
        let allClubs = [];
        let allQuestions = [];
        let editingEventId = null;
        let currentClubId = null;

        // Hardcoded admin email (always has access)
        const HARDCODED_ADMIN = 'm.yusufertek@gmail.com';

        // Auth State
        auth.onAuthStateChanged(async (user) => {
            if (user) {
                // Check if user is admin from database or hardcoded
                const isAdmin = await checkAdminPermission(user.email);
                
                if (isAdmin) {
                    currentAdmin = user;
                    showAdmin();
                    loadDashboardData();
                    loadUsers();
                    loadEvents();
                    loadClubs();
                    loadQuestions();
                    loadClubCreators();
                } else {
                    showToast('Admin yetkisi bulunamadi!', 'error');
                    auth.signOut();
                    showLogin();
                }
            } else {
                currentAdmin = null;
                showLogin();
            }
        });

        // Check Admin Permission
        async function checkAdminPermission(email) {
            // Check hardcoded admin
            if (email === HARDCODED_ADMIN) {
                return true;
            }

            // Check from database
            try {
                const snapshot = await db.ref('admins').once('value');
                if (snapshot.exists()) {
                    const admins = snapshot.val();
                    // Check if email exists in admins (as key or value)
                    for (const key in admins) {
                        if (admins[key] === email || admins[key].email === email || key === email.replace(/\./g, '_')) {
                            return true;
                        }
                    }
                }
            } catch (error) {
                console.error('Admin check error:', error);
            }
            
            return false;
        }

        // Show/Hide
        function showLogin() {
            document.getElementById('loginContainer').style.display = 'flex';
            document.getElementById('adminContainer').style.display = 'none';
        }

        function showAdmin() {
            document.getElementById('loginContainer').style.display = 'none';
            document.getElementById('adminContainer').style.display = 'block';
            document.getElementById('adminName').textContent = currentAdmin.email;
        }

        // Admin Login with Email/Password
        async function handleAdminLogin(e) {
            e.preventDefault();
            const email = document.getElementById('adminEmail').value;
            const password = document.getElementById('adminPassword').value;

            try {
                await auth.signInWithEmailAndPassword(email, password);
            } catch (error) {
                showToast('Giris hatasi: ' + error.message, 'error');
            }
        }

        // Admin Login with Google
        async function handleGoogleAdminLogin() {
            try {
                await auth.signInWithPopup(googleProvider);
            } catch (error) {
                showToast('Google giris hatasi: ' + error.message, 'error');
            }
        }

        function handleLogout() {
            auth.signOut();
            showToast('Cikis yapildi', 'info');
        }

        // Section Switch
        function switchSection(section) {
            document.querySelectorAll('.page-section').forEach(s => s.classList.remove('active'));
            document.querySelectorAll('.sidebar-item').forEach(i => i.classList.remove('active'));
            
            document.getElementById(`section-${section}`).classList.add('active');
            event.currentTarget.classList.add('active');

            // Close sidebar on mobile
            document.getElementById('adminSidebar').classList.remove('open');
            document.getElementById('sidebarOverlay').classList.remove('show');
        }

        // Sidebar Toggle (Mobile)
        function toggleSidebar() {
            document.getElementById('adminSidebar').classList.toggle('open');
            document.getElementById('sidebarOverlay').classList.toggle('show');
        }

        // Load Dashboard Data
        function loadDashboardData() {
            // Users count
            db.ref('users').on('value', (snapshot) => {
                const count = snapshot.numChildren();
                document.getElementById('statUsers').textContent = count;
            });

            // Events count
            db.ref('events').on('value', (snapshot) => {
                const count = snapshot.numChildren();
                document.getElementById('statEvents').textContent = count;
            });

            // Clubs count
            db.ref('clubs').on('value', (snapshot) => {
                const count = snapshot.numChildren();
                document.getElementById('statClubs').textContent = count;
            });

            // Questions count
            loadUnansweredQuestionsCount();

            // Recent users
            loadRecentUsers();
        }

        // Load Recent Users
        function loadRecentUsers() {
            db.ref('users').orderByChild('createdAt').limitToLast(5).on('value', (snapshot) => {
                const container = document.getElementById('recentUsersContainer');
                container.innerHTML = '';

                const users = [];
                snapshot.forEach((child) => {
                    users.push({ id: child.key, ...child.val() });
                });

                users.reverse().forEach((user) => {
                    const el = document.createElement('div');
                    el.className = 'club-item';
                    el.innerHTML = `
                        <img src="${user.avatar || 'https://via.placeholder.com/60'}" alt="${user.name}">
                        <div class="club-item-info">
                            <div class="club-item-name">${user.name}</div>
                            <div class="club-item-stats">${user.email} - ${user.department || 'Belirtilmemis'}</div>
                        </div>
                    `;
                    container.appendChild(el);
                });
            });
        }

        // Load Users
        function loadUsers() {
            db.ref('users').on('value', (snapshot) => {
                allUsers = [];
                snapshot.forEach((child) => {
                    allUsers.push({ id: child.key, ...child.val() });
                });
                renderUsers(allUsers);
            });
        }

        function renderUsers(users) {
            const tbody = document.getElementById('usersTableBody');
            tbody.innerHTML = '';

            users.forEach((user) => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td data-label="Kullanici">
                        <div class="user-item">
                            <img src="${user.avatar || 'https://via.placeholder.com/40'}" alt="${user.name}">
                            <div class="user-item-info">
                                <div class="user-item-name">${user.name}</div>
                                <div class="user-item-email">${user.email}</div>
                            </div>
                        </div>
                    </td>
                    <td data-label="Bolum">${user.department || '-'}</td>
                    <td data-label="Kulup Olusturma">
                        <span class="status-badge ${user.canCreateClub ? 'active' : 'inactive'}">
                            ${user.canCreateClub ? 'Evet' : 'Hayir'}
                        </span>
                    </td>
                    <td data-label="Kayit Tarihi">${formatDate(user.createdAt)}</td>
                    <td data-label="Islemler">
                        <div class="action-btns">
                            <button class="action-btn ${user.canCreateClub ? 'delete' : 'approve'}" onclick="toggleClubPermission('${user.id}', ${!user.canCreateClub})" title="${user.canCreateClub ? 'Yetkiyi Kaldir' : 'Yetki Ver'}">
                                <i class="fas ${user.canCreateClub ? 'fa-times' : 'fa-check'}"></i>
                            </button>
                            <button class="action-btn delete" onclick="deleteUser('${user.id}')" title="Sil">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }

        function filterUsers() {
            const search = document.getElementById('userSearchInput').value.toLowerCase();
            const filtered = allUsers.filter(u => 
                u.name.toLowerCase().includes(search) || 
                u.email.toLowerCase().includes(search)
            );
            renderUsers(filtered);
        }

        // Toggle Club Creation Permission
        async function toggleClubPermission(userId, canCreate) {
            try {
                await db.ref(`users/${userId}/canCreateClub`).set(canCreate);
                showToast(canCreate ? 'Kulup olusturma yetkisi verildi' : 'Yetki kaldirildi', 'success');
            } catch (error) {
                showToast('Hata: ' + error.message, 'error');
            }
        }

        // Delete User
        async function deleteUser(userId) {
            if (!confirm('Bu kullaniciyi silmek istediginize emin misiniz?')) return;
            
            try {
                await db.ref(`users/${userId}`).remove();
                showToast('Kullanici silindi', 'success');
            } catch (error) {
                showToast('Hata: ' + error.message, 'error');
            }
        }

        // Load Events
        function loadEvents() {
            db.ref('events').on('value', (snapshot) => {
                allEvents = [];
                snapshot.forEach((child) => {
                    allEvents.push({ id: child.key, ...child.val() });
                });
                renderEvents(allEvents);
            });
        }

        function renderEvents(events) {
            const tbody = document.getElementById('eventsTableBody');
            tbody.innerHTML = '';

            events.forEach((event) => {
                const participants = event.participants ? Object.keys(event.participants).length : 0;
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td data-label="Gorsel">
                        <img src="${event.image || 'https://via.placeholder.com/40'}" alt="${event.title}">
                    </td>
                    <td data-label="Baslik">${event.title}</td>
                    <td data-label="Tarih">${event.date}</td>
                    <td data-label="Konum">${event.location || '-'}</td>
                    <td data-label="Katilimci">${participants}</td>
                    <td data-label="Islemler">
                        <div class="action-btns">
                            <button class="action-btn edit" onclick="editEvent('${event.id}')" title="Duzenle">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="action-btn delete" onclick="deleteEvent('${event.id}')" title="Sil">
                                <i class="fas fa-trash"></i>
                            </button>
                        </div>
                    </td>
                `;
                tbody.appendChild(tr);
            });
        }

        // Event Modal Functions
        function openEventModal() {
            editingEventId = null;
            document.getElementById('eventModalTitle').textContent = 'Yeni Etkinlik';
            document.getElementById('eventTitle').value = '';
            document.getElementById('eventDescription').value = '';
            document.getElementById('eventDate').value = '';
            document.getElementById('eventTime').value = '';
            document.getElementById('eventLocation').value = '';
            document.getElementById('eventOrganizer').value = '';
            document.getElementById('eventImagePreview').classList.add('hidden');
            document.getElementById('eventModal').style.display = 'flex';
        }

        function closeEventModal() {
            document.getElementById('eventModal').style.display = 'none';
        }

        function editEvent(eventId) {
            editingEventId = eventId;
            const event = allEvents.find(e => e.id === eventId);
            if (!event) return;

            document.getElementById('eventModalTitle').textContent = 'Etkinlik Duzenle';
            document.getElementById('eventTitle').value = event.title || '';
            document.getElementById('eventDescription').value = event.description || '';
            document.getElementById('eventDate').value = event.date || '';
            document.getElementById('eventTime').value = event.time || '';
            document.getElementById('eventLocation').value = event.location || '';
            document.getElementById('eventOrganizer').value = event.organizer || '';
            
            if (event.image) {
                document.getElementById('eventImagePreview').src = event.image;
                document.getElementById('eventImagePreview').classList.remove('hidden');
            }

            document.getElementById('eventModal').style.display = 'flex';
        }

        function previewEventImage(e) {
            const file = e.target.files[0];
            if (file) {
                const reader = new FileReader();
                reader.onload = (ev) => {
                    document.getElementById('eventImagePreview').src = ev.target.result;
                    document.getElementById('eventImagePreview').classList.remove('hidden');
                };
                reader.readAsDataURL(file);
            }
        }

        async function saveEvent() {
            const title = document.getElementById('eventTitle').value.trim();
            const description = document.getElementById('eventDescription').value.trim();
            const date = document.getElementById('eventDate').value;
            const time = document.getElementById('eventTime').value;
            const location = document.getElementById('eventLocation').value.trim();
            const organizer = document.getElementById('eventOrganizer').value.trim();
            const imageInput = document.getElementById('eventImageInput');

            if (!title || !date) {
                showToast('Baslik ve tarih zorunlu', 'error');
                return;
            }

            try {
                let imageUrl = null;

                if (imageInput.files[0]) {
                    imageUrl = await uploadFile(imageInput.files[0], 'events');
                } else if (editingEventId) {
                    const existing = allEvents.find(e => e.id === editingEventId);
                    imageUrl = existing ? existing.image : null;
                }

                const eventData = {
                    title,
                    description,
                    date,
                    time,
                    location,
                    organizer,
                    image: imageUrl,
                    updatedAt: Date.now()
                };

                if (editingEventId) {
                    await db.ref(`events/${editingEventId}`).update(eventData);
                    showToast('Etkinlik guncellendi', 'success');
                } else {
                    eventData.createdAt = Date.now();
                    eventData.participants = {};
                    await db.ref('events').push(eventData);
                    showToast('Etkinlik olusturuldu', 'success');
                }

                closeEventModal();
            } catch (error) {
                showToast('Hata: ' + error.message, 'error');
            }
        }

        async function deleteEvent(eventId) {
            if (!confirm('Bu etkinligi silmek istediginize emin misiniz?')) return;

            try {
                await db.ref(`events/${eventId}`).remove();
                await db.ref(`eventQuestions/${eventId}`).remove();
                showToast('Etkinlik silindi', 'success');
            } catch (error) {
                showToast('Hata: ' + error.message, 'error');
            }
        }

        // Load Clubs
        function loadClubs() {
            db.ref('clubs').on('value', (snapshot) => {
                allClubs = [];
                snapshot.forEach((child) => {
                    allClubs.push({ id: child.key, ...child.val() });
                });
                renderClubs(allClubs);
                renderBadges(allClubs);
            });
        }

        function renderClubs(clubs) {
            const container = document.getElementById('clubsListContainer');
            container.innerHTML = '';

            if (clubs.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-users-slash"></i>
                        <h3>Henuz kulup yok</h3>
                    </div>
                `;
                return;
            }

            clubs.forEach((club) => {
                const memberCount = club.members ? Object.keys(club.members).length : 0;
                const el = document.createElement('div');
                el.className = 'club-item';
                el.innerHTML = `
                    <img src="${club.cover || club.badge || 'https://via.placeholder.com/60'}" alt="${club.name}">
                    <div class="club-item-info">
                        <div class="club-item-name">${club.name}</div>
                        <div class="club-item-stats">${memberCount} uye</div>
                    </div>
                    <div class="club-item-actions">
                        <button class="action-btn view" onclick="viewClubDetail('${club.id}')" title="Detay">
                            <i class="fas fa-eye"></i>
                        </button>
                        <button class="action-btn delete" onclick="deleteClub('${club.id}')" title="Sil">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                `;
                container.appendChild(el);
            });
        }

        function renderBadges(clubs) {
            const container = document.getElementById('badgesListContainer');
            container.innerHTML = '';

            const clubsWithBadges = clubs.filter(c => c.badge);

            if (clubsWithBadges.length === 0) {
                container.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-medal"></i>
                        <h3>Rozet bulunamadi</h3>
                    </div>
                `;
                return;
            }

            clubsWithBadges.forEach((club) => {
                const el = document.createElement('div');
                el.className = 'club-item';
                el.innerHTML = `
                    <img src="${club.badge}" alt="${club.name}" style="border-radius: 8px;">
                    <div class="club-item-info">
                        <div class="club-item-name">${club.name}</div>
                        <div class="club-item-stats">Kulup Rozeti</div>
                    </div>
                `;
                container.appendChild(el);
            });
        }

        function filterClubs() {
            const search = document.getElementById('clubSearchInput').value.toLowerCase();
            const filtered = allClubs.filter(c => c.name.toLowerCase().includes(search));
            renderClubs(filtered);
        }

        function switchClubTab(tab) {
            document.querySelectorAll('#section-clubs .tab').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');
            
            document.getElementById('clubsTab-all').style.display = tab === 'all' ? 'block' : 'none';
            document.getElementById('clubsTab-badges').style.display = tab === 'badges' ? 'block' : 'none';
        }

        async function viewClubDetail(clubId) {
            currentClubId = clubId;
            const club = allClubs.find(c => c.id === clubId);
            if (!club) return;

            const ownerSnapshot = await db.ref(`users/${club.ownerId}`).once('value');
            const owner = ownerSnapshot.val();

            const memberCount = club.members ? Object.keys(club.members).length : 0;
            const modCount = club.moderators ? Object.keys(club.moderators).length : 0;

            document.getElementById('clubDetailContent').innerHTML = `
                <div style="text-align: center; margin-bottom: 20px;">
                    <img src="${club.cover || 'https://via.placeholder.com/200x100'}" alt="" style="width: 100%; height: 100px; object-fit: cover; border-radius: 12px; margin-bottom: 12px;">
                    ${club.badge ? `<img src="${club.badge}" alt="" style="width: 60px; height: 60px; border-radius: 12px; margin-top: -40px; border: 3px solid var(--dark-light);">` : ''}
                    <h3 style="margin-top: 12px;">${club.name}</h3>
                    <p style="color: var(--gray-light); font-size: 14px;">${club.description || 'Aciklama yok'}</p>
                </div>
                <div style="display: grid; grid-template-columns: repeat(3, 1fr); gap: 12px; margin-bottom: 20px;">
                    <div style="text-align: center; padding: 12px; background: var(--dark); border-radius: 12px;">
                        <div style="font-size: 24px; font-weight: 700; color: var(--primary);">${memberCount}</div>
                        <div style="font-size: 12px; color: var(--gray-light);">Uye</div>
                    </div>
                    <div style="text-align: center; padding: 12px; background: var(--dark); border-radius: 12px;">
                        <div style="font-size: 24px; font-weight: 700; color: var(--secondary);">${modCount}</div>
                        <div style="font-size: 12px; color: var(--gray-light);">Moderator</div>
                    </div>
                    <div style="text-align: center; padding: 12px; background: var(--dark); border-radius: 12px;">
                        <div style="width: 24px; height: 24px; background: ${club.chatColor || '#ffffff'}; border-radius: 6px; margin: 0 auto 4px;"></div>
                        <div style="font-size: 12px; color: var(--gray-light);">Sohbet Rengi</div>
                    </div>
                </div>
                <div style="padding: 12px; background: var(--dark); border-radius: 12px;">
                    <div style="font-size: 12px; color: var(--gray-light); margin-bottom: 4px;">Kulup Sahibi</div>
                    <div style="display: flex; align-items: center; gap: 8px;">
                        <img src="${owner ? owner.avatar : 'https://via.placeholder.com/32'}" alt="" style="width: 32px; height: 32px; border-radius: 50%;">
                        <span>${owner ? owner.name : 'Bilinmiyor'}</span>
                    </div>
                </div>
            `;

            document.getElementById('clubDetailModal').style.display = 'flex';
        }

        function closeClubDetailModal() {
            document.getElementById('clubDetailModal').style.display = 'none';
            currentClubId = null;
        }

        async function deleteCurrentClub() {
            if (!currentClubId) return;
            await deleteClub(currentClubId);
            closeClubDetailModal();
        }

        async function deleteClub(clubId) {
            if (!confirm('Bu kulubu silmek istediginize emin misiniz? Tum veriler silinecek.')) return;

            try {
                // Get club data first
                const clubSnapshot = await db.ref(`clubs/${clubId}`).once('value');
                const club = clubSnapshot.val();

                // Remove badge from all members
                if (club && club.members) {
                    for (const memberId of Object.keys(club.members)) {
                        await db.ref(`users/${memberId}/badges/${clubId}`).remove();
                        await db.ref(`users/${memberId}/activeBadges/${clubId}`).remove();
                        await db.ref(`users/${memberId}/clubs/${clubId}`).remove();
                    }
                }

                // Delete club data
                await db.ref(`clubs/${clubId}`).remove();
                await db.ref(`clubChats/${clubId}`).remove();
                await db.ref(`clubAnnouncements/${clubId}`).remove();

                showToast('Kulup silindi', 'success');
            } catch (error) {
                showToast('Hata: ' + error.message, 'error');
            }
        }

        // Load Club Creators
        function loadClubCreators() {
            db.ref('users').on('value', (snapshot) => {
                const approvedContainer = document.getElementById('approvedCreatorsContainer');
                const pendingContainer = document.getElementById('pendingCreatorsContainer');
                const allContainer = document.getElementById('allCreatorsContainer');

                approvedContainer.innerHTML = '';
                pendingContainer.innerHTML = '';
                allContainer.innerHTML = '';

                const approved = [];
                const pending = [];
                const all = [];

                snapshot.forEach((child) => {
                    const user = { id: child.key, ...child.val() };
                    all.push(user);

                    if (user.canCreateClub) {
                        approved.push(user);
                    }

                    if (user.clubCreatorRequest && !user.canCreateClub) {
                        pending.push(user);
                    }
                });

                // Render approved
                if (approved.length === 0) {
                    approvedContainer.innerHTML = '<p style="color: var(--gray-light);">Henuz yetkili kullanici yok</p>';
                } else {
                    approved.forEach(user => {
                        approvedContainer.appendChild(createCreatorItem(user, true));
                    });
                }

                // Render pending
                if (pending.length === 0) {
                    pendingContainer.innerHTML = '<p style="color: var(--gray-light);">Bekleyen talep yok</p>';
                } else {
                    pending.forEach(user => {
                        pendingContainer.appendChild(createCreatorItem(user, false, true));
                    });
                }

                // Render all
                all.forEach(user => {
                    allContainer.appendChild(createCreatorItem(user, user.canCreateClub));
                });
            });
        }

        function createCreatorItem(user, isApproved, isPending = false) {
            const el = document.createElement('div');
            el.className = 'club-item';
            el.innerHTML = `
                <img src="${user.avatar || 'https://via.placeholder.com/60'}" alt="${user.name}">
                <div class="club-item-info">
                    <div class="club-item-name">${user.name}</div>
                    <div class="club-item-stats">${user.email}</div>
                </div>
                <div class="club-item-actions">
                    ${isPending ? `
                        <button class="action-btn approve" onclick="approveCreator('${user.id}')" title="Onayla">
                            <i class="fas fa-check"></i>
                        </button>
                        <button class="action-btn delete" onclick="rejectCreator('${user.id}')" title="Reddet">
                            <i class="fas fa-times"></i>
                        </button>
                    ` : `
                        <button class="action-btn ${isApproved ? 'delete' : 'approve'}" onclick="toggleClubPermission('${user.id}', ${!isApproved})" title="${isApproved ? 'Yetkiyi Kaldir' : 'Yetki Ver'}">
                            <i class="fas ${isApproved ? 'fa-times' : 'fa-check'}"></i>
                        </button>
                    `}
                </div>
            `;
            return el;
        }

        async function approveCreator(userId) {
            try {
                await db.ref(`users/${userId}`).update({
                    canCreateClub: true,
                    clubCreatorRequest: null
                });
                showToast('Kulup olusturma yetkisi verildi', 'success');
            } catch (error) {
                showToast('Hata: ' + error.message, 'error');
            }
        }

        async function rejectCreator(userId) {
            try {
                await db.ref(`users/${userId}/clubCreatorRequest`).remove();
                showToast('Talep reddedildi', 'info');
            } catch (error) {
                showToast('Hata: ' + error.message, 'error');
            }
        }

        function switchCreatorTab(tab) {
            document.querySelectorAll('#section-creators .tab').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');
            
            document.getElementById('creatorsTab-approved').style.display = tab === 'approved' ? 'block' : 'none';
            document.getElementById('creatorsTab-pending').style.display = tab === 'pending' ? 'block' : 'none';
            document.getElementById('creatorsTab-all').style.display = tab === 'all' ? 'block' : 'none';
        }

        function filterCreators() {
            const search = document.getElementById('creatorSearchInput').value.toLowerCase();
            const container = document.getElementById('allCreatorsContainer');
            container.innerHTML = '';

            allUsers.filter(u => 
                u.name.toLowerCase().includes(search) || 
                u.email.toLowerCase().includes(search)
            ).forEach(user => {
                container.appendChild(createCreatorItem(user, user.canCreateClub));
            });
        }

        // Load Questions
        function loadQuestions() {
            db.ref('eventQuestions').on('value', (snapshot) => {
                allQuestions = [];
                
                snapshot.forEach((eventChild) => {
                    const eventId = eventChild.key;
                    eventChild.forEach((questionChild) => {
                        allQuestions.push({
                            id: questionChild.key,
                            eventId: eventId,
                            ...questionChild.val()
                        });
                    });
                });

                renderQuestions();
            });
        }

        function loadUnansweredQuestionsCount() {
            db.ref('eventQuestions').on('value', (snapshot) => {
                let count = 0;
                
                snapshot.forEach((eventChild) => {
                    eventChild.forEach((questionChild) => {
                        const question = questionChild.val();
                        if (!question.answer) count++;
                    });
                });

                document.getElementById('statQuestions').textContent = count;
                
                const badge = document.getElementById('questionsBadge');
                if (count > 0) {
                    badge.textContent = count;
                    badge.classList.remove('hidden');
                } else {
                    badge.classList.add('hidden');
                }
            });
        }

        async function renderQuestions() {
            const unansweredContainer = document.getElementById('unansweredQuestionsContainer');
            const answeredContainer = document.getElementById('answeredQuestionsContainer');
            
            unansweredContainer.innerHTML = '';
            answeredContainer.innerHTML = '';

            const unanswered = allQuestions.filter(q => !q.answer);
            const answered = allQuestions.filter(q => q.answer);

            if (unanswered.length === 0) {
                unansweredContainer.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-check-circle"></i>
                        <h3>Tum sorular cevaplandi</h3>
                    </div>
                `;
            } else {
                for (const q of unanswered) {
                    const event = allEvents.find(e => e.id === q.eventId);
                    const el = await createQuestionCard(q, event, false);
                    unansweredContainer.appendChild(el);
                }
            }

            if (answered.length === 0) {
                answeredContainer.innerHTML = `
                    <div class="empty-state">
                        <i class="fas fa-inbox"></i>
                        <h3>Cevaplanan soru yok</h3>
                    </div>
                `;
            } else {
                for (const q of answered) {
                    const event = allEvents.find(e => e.id === q.eventId);
                    const el = await createQuestionCard(q, event, true);
                    answeredContainer.appendChild(el);
                }
            }
        }

        async function createQuestionCard(question, event, isAnswered) {
            const el = document.createElement('div');
            el.className = 'question-card';
            
            el.innerHTML = `
                <div class="question-header">
                    <img src="${question.userAvatar || 'https://via.placeholder.com/40'}" alt="">
                    <div>
                        <div class="question-user">${question.userName}</div>
                        <div class="question-event">${event ? event.title : 'Bilinmeyen Etkinlik'}</div>
                    </div>
                </div>
                <p class="question-text">${question.text}</p>
                ${isAnswered ? `
                    <div style="padding: 12px; background: rgba(99, 102, 241, 0.1); border-radius: 10px; border-left: 3px solid var(--primary); margin-top: 12px;">
                        <div style="font-size: 12px; color: var(--primary); margin-bottom: 4px;">Cevap</div>
                        <p style="font-size: 14px; color: var(--gray-light);">${question.answer}</p>
                    </div>
                ` : `
                    <div class="question-answer-input">
                        <input type="text" id="answer-${question.id}" placeholder="Cevaplayin...">
                        <button class="btn btn-primary btn-small" onclick="answerQuestion('${question.eventId}', '${question.id}')">
                            <i class="fas fa-paper-plane"></i>
                        </button>
                    </div>
                `}
            `;
            
            return el;
        }

        async function answerQuestion(eventId, questionId) {
            const input = document.getElementById(`answer-${questionId}`);
            const answer = input.value.trim();

            if (!answer) {
                showToast('Lutfen bir cevap yazin', 'error');
                return;
            }

            try {
                await db.ref(`eventQuestions/${eventId}/${questionId}/answer`).set(answer);
                showToast('Soru cevaplandi', 'success');
            } catch (error) {
                showToast('Hata: ' + error.message, 'error');
            }
        }

        function switchQuestionTab(tab) {
            document.querySelectorAll('#section-questions .tab').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');
            
            document.getElementById('questionsTab-unanswered').style.display = tab === 'unanswered' ? 'block' : 'none';
            document.getElementById('questionsTab-answered').style.display = tab === 'answered' ? 'block' : 'none';
        }

        // Send Mass Notification
        async function sendMassNotification() {
            const title = document.getElementById('notificationTitle').value.trim();
            const message = document.getElementById('notificationMessage').value.trim();
            const target = document.getElementById('notificationTarget').value;

            if (!title || !message) {
                showToast('Baslik ve mesaj gerekli', 'error');
                return;
            }

            try {
                let targetUsers = [];

                if (target === 'all') {
                    targetUsers = allUsers.map(u => u.id);
                } else if (target === 'clubOwners') {
                    const clubOwnerIds = allClubs.map(c => c.ownerId);
                    targetUsers = [...new Set(clubOwnerIds)];
                } else if (target === 'eventParticipants') {
                    const participantIds = [];
                    allEvents.forEach(e => {
                        if (e.participants) {
                            participantIds.push(...Object.keys(e.participants));
                        }
                    });
                    targetUsers = [...new Set(participantIds)];
                }

                for (const userId of targetUsers) {
                    await db.ref(`notifications/${userId}`).push({
                        title: title,
                        message: `${title}: ${message}`,
                        read: false,
                        timestamp: Date.now()
                    });
                }

                showToast(`${targetUsers.length} kullaniciya bildirim gonderildi`, 'success');
                document.getElementById('notificationTitle').value = '';
                document.getElementById('notificationMessage').value = '';
            } catch (error) {
                showToast('Hata: ' + error.message, 'error');
            }
        }

        // Upload File to Storage
        async function uploadFile(file, folder) {
            const timestamp = Date.now();
            const filename = `${folder}/admin_${timestamp}_${file.name}`;
            const storageRef = storage.ref(filename);
            
            await storageRef.put(file);
            return await storageRef.getDownloadURL();
        }

        // Format Date
        function formatDate(timestamp) {
            if (!timestamp) return '-';
            const date = new Date(timestamp);
            return date.toLocaleDateString('tr-TR');
        }

        // Show Toast
        function showToast(message, type = 'info') {
            const container = document.getElementById('toastContainer');
            const toast = document.createElement('div');
            toast.className = `toast ${type}`;
            toast.innerHTML = `
                <i class="fas ${type === 'success' ? 'fa-check-circle' : type === 'error' ? 'fa-exclamation-circle' : 'fa-info-circle'}"></i>
                <span>${message}</span>
            `;
            container.appendChild(toast);

            setTimeout(() => {
                toast.remove();
            }, 3000);
        }
    </script>
</body>
</html>
