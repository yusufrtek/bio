<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover"/>
  <title>Ãœlke Tahmin Oyunu</title>

  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"/>

  <style>
    html, body { height:100%; margin:0; }
    #map { height:100%; width:100%; }

    /* Oyun UI overlay */
    .ui {
      position: fixed;
      inset: 0;
      pointer-events: none;
      display: grid;
      align-items: start;
      justify-items: center;
      padding: calc(14px + env(safe-area-inset-top)) 14px calc(14px + env(safe-area-inset-bottom)) 14px;
      z-index: 9999;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial;
    }

    .topbar {
      pointer-events: auto;
      width: min(720px, 100%);
      display: flex;
      gap: 10px;
      align-items: center;
      justify-content: space-between;
      background: rgba(255,255,255,.9);
      border: 1px solid rgba(0,0,0,.08);
      border-radius: 16px;
      padding: 10px 12px;
      box-shadow: 0 18px 50px rgba(0,0,0,.22);
      backdrop-filter: blur(14px);
      -webkit-backdrop-filter: blur(14px);
    }

    .score {
      font-weight: 800;
      font-size: 14px;
      white-space: nowrap;
    }

    .guess {
      display:flex;
      gap: 10px;
      align-items:center;
      flex: 1;
      justify-content: flex-end;
    }

    input {
      width: min(360px, 52vw);
      padding: 10px 12px;
      border-radius: 14px;
      border: 1px solid rgba(0,0,0,.12);
      outline: none;
      font-size: 14px;
      background: rgba(255,255,255,.95);
    }

    button {
      padding: 10px 12px;
      border-radius: 14px;
      border: 1px solid rgba(0,0,0,.12);
      background: rgba(0,0,0,.92);
      color: #fff;
      font-weight: 800;
      cursor: pointer;
      user-select: none;
    }
    button:active { transform: scale(.99); }

    .toast {
      pointer-events:none;
      margin-top: 10px;
      width: min(720px, 100%);
      display:flex;
      justify-content:center;
    }
    .toast > div {
      background: rgba(0,0,0,.82);
      color: #fff;
      border-radius: 999px;
      padding: 10px 14px;
      font-size: 13px;
      opacity: 0;
      transform: translateY(-6px);
      transition: opacity .2s ease, transform .2s ease;
    }
    .toast.show > div { opacity: 1; transform: translateY(0); }

    /* Start screen */
    .start {
      position: fixed;
      inset: 0;
      background: radial-gradient(1200px 800px at 20% 10%, rgba(0,0,0,.15), transparent),
                  radial-gradient(900px 600px at 80% 30%, rgba(0,0,0,.12), transparent),
                  rgba(0,0,0,.35);
      display: grid;
      place-items: center;
      z-index: 10000;
      padding: 18px;
    }
    .startCard{
      width: min(720px, 100%);
      background: rgba(255,255,255,.92);
      border: 1px solid rgba(0,0,0,.08);
      border-radius: 20px;
      padding: 18px;
      box-shadow: 0 25px 80px rgba(0,0,0,.35);
      backdrop-filter: blur(16px);
      -webkit-backdrop-filter: blur(16px);
    }
    .startCard h1{ margin: 0 0 8px; font-size: 22px; }
    .startCard p{ margin: 0 0 14px; opacity:.8; line-height:1.4; }
    .startRow{ display:flex; gap:10px; flex-wrap:wrap; align-items:center; justify-content: space-between; }
    .startRow .mini{ opacity:.75; font-size: 12px; }

    /* Leaflet country hover */
    .leaflet-interactive { transition: fill-opacity .15s ease; }
  </style>
</head>
<body>
  <div id="map"></div>

  <div class="ui">
    <div class="topbar">
      <div class="score" id="score">Skor: 0 âœ… | Hata: 0 âŒ</div>
      <div class="guess">
        <input id="answer" placeholder="Ãœlke adÄ±nÄ± yaz..." autocomplete="off" />
        <button id="submit">Kontrol</button>
      </div>
    </div>

    <div class="toast" id="toast"><div id="toastText"></div></div>
  </div>

  <div class="start" id="start">
    <div class="startCard">
      <h1>Ãœlke Tahmin Oyunu</h1>
      <p>Haritada rastgele bir Ã¼lke seÃ§ilecek. Ãœlke adÄ± gÃ¶sterilmeyecek. Sen doÄŸru Ã¼lke adÄ±nÄ± yazÄ±nca Ã¼lke yeÅŸile dÃ¶necek ve bir sonraki Ã¼lkeye geÃ§ilecek.</p>
      <div class="startRow">
        <div class="mini">Ä°pucu: TÃ¼rkÃ§e karakterlere takÄ±lmamasÄ± iÃ§in otomatik normalize ediyoruz.</div>
        <button id="startBtn">BaÅŸla</button>
      </div>
    </div>
  </div>

  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>

  <script>
    // ---------- Ayarlar ----------
    const GEOJSON_URL = "./countries.geojson"; // aynÄ± klasÃ¶rde olmalÄ±

    // Natural Earth alan adlarÄ± Ã§oÄŸunlukla NAME, ADMIN gibi gelir.
    // EÄŸer senin dosyada farklÄ±ysa burayÄ± deÄŸiÅŸtirirsin.
    const NAME_FIELDS = ["ADMIN", "NAME", "NAME_EN", "NAME_LONG", "SOVEREIGNT"];

    // ---------- Harita ----------
    const map = L.map("map", { zoomControl: true, worldCopyJump: true }).setView([20, 0], 2);

    L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png", {
      maxZoom: 19,
      attribution: "Â© OpenStreetMap"
    }).addTo(map);

    let countriesLayer;
    let countries = [];     // { feature, layer, name }
    let current = null;     // seÃ§ili Ã¼lke
    let scoreOk = 0, scoreBad = 0;

    const $ = (id) => document.getElementById(id);
    const answerEl = $("answer");

    function toast(msg){
      $("toastText").textContent = msg;
      $("toast").classList.add("show");
      setTimeout(() => $("toast").classList.remove("show"), 900);
    }

    function updateScore(){
      $("score").textContent = `Skor: ${scoreOk} âœ… | Hata: ${scoreBad} âŒ`;
    }

    // TÃ¼rkÃ§e/aksan farklarÄ±nÄ± azalt: "TÃ¼rkiye" = "turkiye"
    function normalizeText(s){
      return String(s || "")
        .trim()
        .toLocaleLowerCase("tr-TR")
        .normalize("NFD").replace(/[\u0300-\u036f]/g, "") // aksanlarÄ± sil
        .replace(/Ä±/g, "i") // ekstra garanti
        .replace(/\s+/g, " ");
    }

    function getCountryName(props){
      for (const k of NAME_FIELDS){
        if (props && props[k]) return String(props[k]);
      }
      return null;
    }

    function resetStyles(){
      countries.forEach(c => c.layer.setStyle({
        color: "rgba(0,0,0,.35)",
        weight: 1,
        fillColor: "rgba(0,0,0,.08)",
        fillOpacity: 0.25
      }));
    }

    function setCurrentStyle(layer){
      layer.setStyle({
        color: "rgba(0,0,0,.55)",
        weight: 2,
        fillColor: "rgba(0,0,0,.10)",
        fillOpacity: 0.45
      });
    }

    function setCorrectStyle(layer){
      layer.setStyle({
        color: "rgba(0,0,0,.55)",
        weight: 2,
        fillColor: "rgba(0,128,0,.55)",
        fillOpacity: 0.65
      });
    }

    function pickRandomCountry(){
      const pool = countries.filter(c => !c.correct); // doÄŸru bilinenleri tekrar seÃ§me
      if (pool.length === 0){
        toast("Bitti! Hepsini bildin ğŸ˜„");
        return;
      }
      current = pool[Math.floor(Math.random() * pool.length)];
      resetStyles();
      setCurrentStyle(current.layer);
      map.fitBounds(current.layer.getBounds().pad(0.25), { animate: true });
      answerEl.value = "";
      answerEl.focus();
      // Ãœlke adÄ±nÄ± gÃ¶stermiyoruz. Ä°stersen debug iÃ§in console.log(current.name)
    }

    function checkAnswer(){
      if (!current) return;
      const typed = normalizeText(answerEl.value);
      const real = normalizeText(current.name);

      if (!typed){
        toast("Ãœlke adÄ±nÄ± yaz.");
        return;
      }

      if (typed === real){
        scoreOk++;
        current.correct = true;
        setCorrectStyle(current.layer);
        toast("DoÄŸru! âœ…");
        updateScore();
        setTimeout(pickRandomCountry, 650);
      } else {
        scoreBad++;
        updateScore();
        toast("YanlÄ±ÅŸ âŒ Tekrar dene");
      }
    }

    $("submit").addEventListener("click", checkAnswer);
    answerEl.addEventListener("keydown", (e) => {
      if (e.key === "Enter") checkAnswer();
    });

    $("startBtn").addEventListener("click", () => {
      $("start").style.display = "none";
      pickRandomCountry();
    });

    // ---------- GeoJSON yÃ¼kle ----------
    fetch(GEOJSON_URL)
      .then(r => {
        if (!r.ok) throw new Error("GeoJSON yÃ¼klenemedi: " + r.status);
        return r.json();
      })
      .then(geo => {
        countriesLayer = L.geoJSON(geo, {
          style: {
            color: "rgba(0,0,0,.35)",
            weight: 1,
            fillColor: "rgba(0,0,0,.08)",
            fillOpacity: 0.25
          },
          onEachFeature: (feature, layer) => {
            const name = getCountryName(feature.properties) || "Unknown";
            countries.push({ feature, layer, name, correct: false });

            // hover efekti
            layer.on("mouseover", () => layer.setStyle({ fillOpacity: 0.40 }));
            layer.on("mouseout", () => {
              if (current && layer === current.layer) setCurrentStyle(layer);
              else if (countries.find(c => c.layer === layer)?.correct) setCorrectStyle(layer);
              else layer.setStyle({ fillOpacity: 0.25 });
            });
          }
        }).addTo(map);

        updateScore();
      })
      .catch(err => {
        console.error(err);
        alert("countries.geojson yÃ¼klenemedi. Dosya aynÄ± klasÃ¶rde mi?");
      });
  </script>
</body>
</html>
