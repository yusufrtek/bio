<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>LENG Admin Panel</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/remixicon@3.5.0/fonts/remixicon.css" rel="stylesheet">
  <script src="https://unpkg.com/html5-qrcode@2.3.8/html5-qrcode.min.js"></script>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    :root {
      --bg-primary: #ffffff;
      --bg-secondary: #f8f9fa;
      --bg-tertiary: #f1f3f4;
      --text-primary: #1a1a1a;
      --text-secondary: #5f6368;
      --text-muted: #9aa0a6;
      --border-color: #e8eaed;
      --border-dark: #dadce0;
      --accent: #1a1a1a;
      --accent-light: #f1f3f4;
      --success: #34a853;
      --warning: #fbbc04;
      --danger: #ea4335;
      --info: #4285f4;
      --shadow-sm: 0 1px 2px rgba(0,0,0,0.05);
      --shadow-md: 0 4px 6px rgba(0,0,0,0.07);
      --shadow-lg: 0 10px 25px rgba(0,0,0,0.1);
      --radius-sm: 6px;
      --radius-md: 10px;
      --radius-lg: 16px;
    }

    body {
      font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
      background: var(--bg-secondary);
      color: var(--text-primary);
      min-height: 100vh;
      line-height: 1.5;
    }

    /* Login Screen */
    .login-screen {
      display: flex;
      align-items: center;
      justify-content: center;
      min-height: 100vh;
      padding: 20px;
      background: linear-gradient(135deg, #f5f5f5 0%, #e8e8e8 100%);
    }

    .login-card {
      background: var(--bg-primary);
      border-radius: var(--radius-lg);
      padding: 48px 40px;
      width: 100%;
      max-width: 420px;
      box-shadow: var(--shadow-lg);
      text-align: center;
    }

    .login-logo {
      font-size: 32px;
      font-weight: 700;
      color: var(--text-primary);
      margin-bottom: 8px;
      letter-spacing: -1px;
    }

    .login-subtitle {
      color: var(--text-secondary);
      margin-bottom: 32px;
      font-size: 14px;
    }

    .login-error {
      background: #fef2f2;
      color: var(--danger);
      padding: 12px;
      border-radius: var(--radius-sm);
      margin-bottom: 16px;
      font-size: 13px;
      display: none;
    }

    .google-btn {
      width: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 12px;
      padding: 14px 24px;
      border-radius: var(--radius-md);
      border: 1px solid var(--border-color);
      background: var(--bg-primary);
      color: var(--text-primary);
      font-size: 15px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
    }

    .google-btn:hover {
      border-color: var(--accent);
      box-shadow: var(--shadow-md);
    }

    .google-btn svg {
      width: 20px;
      height: 20px;
    }

    /* Main Layout */
    .admin-container {
      display: none;
      min-height: 100vh;
    }

    .admin-container.active {
      display: flex;
    }

    /* Sidebar */
    .sidebar {
      width: 260px;
      background: var(--bg-primary);
      border-right: 1px solid var(--border-color);
      height: 100vh;
      position: fixed;
      left: 0;
      top: 0;
      display: flex;
      flex-direction: column;
      z-index: 100;
      transition: transform 0.3s ease;
    }

    .sidebar-header {
      padding: 24px;
      border-bottom: 1px solid var(--border-color);
    }

    .sidebar-logo {
      font-size: 24px;
      font-weight: 700;
      color: var(--text-primary);
      letter-spacing: -0.5px;
    }

    .sidebar-label {
      font-size: 11px;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 1px;
      margin-top: 4px;
    }

    .sidebar-nav {
      flex: 1;
      padding: 16px 12px;
      overflow-y: auto;
    }

    .nav-section {
      margin-bottom: 24px;
    }

    .nav-section-title {
      font-size: 11px;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 1px;
      padding: 0 12px;
      margin-bottom: 8px;
    }

    .nav-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px;
      border-radius: var(--radius-md);
      color: var(--text-secondary);
      cursor: pointer;
      transition: all 0.2s;
      font-size: 14px;
      font-weight: 500;
    }

    .nav-item:hover {
      background: var(--bg-tertiary);
      color: var(--text-primary);
    }

    .nav-item.active {
      background: var(--accent);
      color: white;
    }

    .nav-item i {
      font-size: 18px;
      width: 20px;
    }

    .nav-item .badge {
      margin-left: auto;
      background: var(--danger);
      color: white;
      font-size: 11px;
      padding: 2px 8px;
      border-radius: 10px;
      font-weight: 600;
    }

    .nav-item.active .badge {
      background: white;
      color: var(--accent);
    }

    .sidebar-footer {
      padding: 16px;
      border-top: 1px solid var(--border-color);
    }

    .admin-profile {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px;
      border-radius: var(--radius-md);
      background: var(--bg-secondary);
    }

    .admin-avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: var(--accent);
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      overflow: hidden;
    }

    .admin-avatar img {
      width: 100%;
      height: 100%;
      object-fit: cover;
    }

    .admin-info {
      flex: 1;
      min-width: 0;
    }

    .admin-name {
      font-weight: 600;
      font-size: 14px;
      white-space: nowrap;
      overflow: hidden;
      text-overflow: ellipsis;
    }

    .admin-role {
      font-size: 12px;
      color: var(--text-muted);
    }

    /* Main Content */
    .main-content {
      flex: 1;
      margin-left: 260px;
      min-height: 100vh;
    }

    /* Top Header */
    .top-header {
      background: var(--bg-primary);
      border-bottom: 1px solid var(--border-color);
      padding: 16px 32px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      position: sticky;
      top: 0;
      z-index: 50;
    }

    .header-left {
      display: flex;
      align-items: center;
      gap: 16px;
    }

    .menu-toggle {
      display: none;
      background: none;
      border: none;
      font-size: 24px;
      color: var(--text-primary);
      cursor: pointer;
      padding: 8px;
      border-radius: var(--radius-sm);
    }

    .menu-toggle:hover {
      background: var(--bg-tertiary);
    }

    .page-title {
      font-size: 20px;
      font-weight: 600;
    }

    .header-right {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .header-btn {
      width: 40px;
      height: 40px;
      border-radius: var(--radius-md);
      background: var(--bg-secondary);
      border: none;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      position: relative;
      color: var(--text-secondary);
      transition: all 0.2s;
    }

    .header-btn:hover {
      background: var(--bg-tertiary);
      color: var(--text-primary);
    }

    /* Page Content */
    .page-content {
      padding: 32px;
    }

    .page-section {
      display: none;
    }

    .page-section.active {
      display: block;
    }

    /* Stats Grid */
    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
      gap: 20px;
      margin-bottom: 32px;
    }

    .stat-card {
      background: var(--bg-primary);
      border-radius: var(--radius-lg);
      padding: 24px;
      box-shadow: var(--shadow-sm);
      border: 1px solid var(--border-color);
    }

    .stat-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      margin-bottom: 16px;
    }

    .stat-icon {
      width: 48px;
      height: 48px;
      border-radius: var(--radius-md);
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 24px;
    }

    .stat-icon.users { background: #e8f5e9; color: var(--success); }
    .stat-icon.events { background: #e3f2fd; color: var(--info); }
    .stat-icon.games { background: #fff3e0; color: #f57c00; }
    .stat-icon.clubs { background: #f3e5f5; color: #9c27b0; }

    .stat-value {
      font-size: 32px;
      font-weight: 700;
      margin-bottom: 4px;
    }

    .stat-label {
      color: var(--text-secondary);
      font-size: 14px;
    }

    /* Card Component */
    .card {
      background: var(--bg-primary);
      border-radius: var(--radius-lg);
      box-shadow: var(--shadow-sm);
      border: 1px solid var(--border-color);
      overflow: hidden;
    }

    .card-header {
      padding: 20px 24px;
      border-bottom: 1px solid var(--border-color);
      display: flex;
      align-items: center;
      justify-content: space-between;
      flex-wrap: wrap;
      gap: 12px;
    }

    .card-title {
      font-size: 16px;
      font-weight: 600;
    }

    .card-body {
      padding: 24px;
    }

    /* Search & Filters */
    .filters-bar {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
      align-items: center;
    }

    .search-box {
      position: relative;
      flex: 1;
      min-width: 200px;
      max-width: 320px;
    }

    .search-box i {
      position: absolute;
      left: 14px;
      top: 50%;
      transform: translateY(-50%);
      color: var(--text-muted);
    }

    .search-box input {
      width: 100%;
      padding: 10px 14px 10px 42px;
      border: 1px solid var(--border-color);
      border-radius: var(--radius-md);
      font-size: 14px;
      background: var(--bg-secondary);
      transition: all 0.2s;
    }

    .search-box input:focus {
      outline: none;
      border-color: var(--accent);
      background: var(--bg-primary);
    }

    .filter-select {
      padding: 10px 14px;
      border: 1px solid var(--border-color);
      border-radius: var(--radius-md);
      font-size: 14px;
      background: var(--bg-secondary);
      cursor: pointer;
      min-width: 140px;
    }

    .filter-select:focus {
      outline: none;
      border-color: var(--accent);
    }

    /* Table */
    .table-container {
      overflow-x: auto;
    }

    .data-table {
      width: 100%;
      border-collapse: collapse;
    }

    .data-table th,
    .data-table td {
      padding: 14px 16px;
      text-align: left;
      border-bottom: 1px solid var(--border-color);
    }

    .data-table th {
      background: var(--bg-secondary);
      font-weight: 600;
      font-size: 12px;
      text-transform: uppercase;
      letter-spacing: 0.5px;
      color: var(--text-secondary);
      white-space: nowrap;
    }

    .data-table td {
      font-size: 14px;
      vertical-align: middle;
    }

    .data-table tr:hover td {
      background: var(--bg-secondary);
    }

    .user-cell {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .user-avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      object-fit: cover;
      background: var(--bg-tertiary);
    }

    .user-avatar-placeholder {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: var(--accent);
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-weight: 600;
      font-size: 14px;
    }

    .user-name {
      font-weight: 500;
    }

    .user-email {
      font-size: 12px;
      color: var(--text-muted);
    }

    /* Badges */
    .badge {
      display: inline-flex;
      align-items: center;
      gap: 4px;
      padding: 4px 10px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 500;
    }

    .badge-success { background: #e8f5e9; color: var(--success); }
    .badge-warning { background: #fff3e0; color: #f57c00; }
    .badge-danger { background: #fef2f2; color: var(--danger); }
    .badge-info { background: #e3f2fd; color: var(--info); }
    .badge-default { background: var(--bg-tertiary); color: var(--text-secondary); }

    /* Action Buttons */
    .action-btns {
      display: flex;
      gap: 8px;
    }

    .action-btn {
      width: 32px;
      height: 32px;
      border-radius: var(--radius-sm);
      border: none;
      display: flex;
      align-items: center;
      justify-content: center;
      cursor: pointer;
      transition: all 0.2s;
      font-size: 16px;
    }

    .action-btn.view {
      background: #e3f2fd;
      color: var(--info);
    }

    .action-btn.edit {
      background: #fff3e0;
      color: #f57c00;
    }

    .action-btn.delete {
      background: #fef2f2;
      color: var(--danger);
    }

    .action-btn.success {
      background: #e8f5e9;
      color: var(--success);
    }

    .action-btn:hover {
      transform: scale(1.1);
    }

    /* Buttons */
    .btn {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 10px 20px;
      border-radius: var(--radius-md);
      font-size: 14px;
      font-weight: 500;
      cursor: pointer;
      transition: all 0.2s;
      border: none;
    }

    .btn-primary {
      background: var(--accent);
      color: white;
    }

    .btn-primary:hover {
      background: #333;
    }

    .btn-secondary {
      background: var(--bg-secondary);
      color: var(--text-primary);
      border: 1px solid var(--border-color);
    }

    .btn-secondary:hover {
      background: var(--bg-tertiary);
    }

    .btn-danger {
      background: var(--danger);
      color: white;
    }

    .btn-danger:hover {
      background: #d32f2f;
    }

    .btn-success {
      background: var(--success);
      color: white;
    }

    .btn-sm {
      padding: 6px 12px;
      font-size: 12px;
    }

    /* Modal */
    .modal-overlay {
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.5);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 1000;
      padding: 20px;
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s;
    }

    .modal-overlay.active {
      opacity: 1;
      visibility: visible;
    }

    .modal {
      background: var(--bg-primary);
      border-radius: var(--radius-lg);
      width: 100%;
      max-width: 600px;
      max-height: 90vh;
      overflow-y: auto;
      transform: scale(0.9);
      transition: transform 0.3s;
    }

    .modal-overlay.active .modal {
      transform: scale(1);
    }

    .modal-header {
      padding: 20px 24px;
      border-bottom: 1px solid var(--border-color);
      display: flex;
      align-items: center;
      justify-content: space-between;
    }

    .modal-title {
      font-size: 18px;
      font-weight: 600;
    }

    .modal-close {
      width: 36px;
      height: 36px;
      border-radius: var(--radius-sm);
      border: none;
      background: var(--bg-secondary);
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      color: var(--text-secondary);
    }

    .modal-close:hover {
      background: var(--bg-tertiary);
    }

    .modal-body {
      padding: 24px;
    }

    .modal-footer {
      padding: 16px 24px;
      border-top: 1px solid var(--border-color);
      display: flex;
      gap: 12px;
      justify-content: flex-end;
    }

    /* Form Elements */
    .form-group {
      margin-bottom: 20px;
    }

    .form-label {
      display: block;
      font-size: 13px;
      font-weight: 500;
      margin-bottom: 8px;
      color: var(--text-secondary);
    }

    .form-input {
      width: 100%;
      padding: 12px 14px;
      border: 1px solid var(--border-color);
      border-radius: var(--radius-md);
      font-size: 14px;
      transition: all 0.2s;
      background: var(--bg-secondary);
    }

    .form-input:focus {
      outline: none;
      border-color: var(--accent);
      background: var(--bg-primary);
    }

    .form-textarea {
      resize: vertical;
      min-height: 100px;
    }

    /* User Detail View */
    .user-detail {
      display: grid;
      grid-template-columns: 200px 1fr;
      gap: 24px;
    }

    .user-detail-sidebar {
      text-align: center;
    }

    .user-detail-avatar {
      width: 120px;
      height: 120px;
      border-radius: 50%;
      object-fit: cover;
      margin: 0 auto 16px;
      border: 4px solid var(--border-color);
    }

    .user-detail-name {
      font-size: 20px;
      font-weight: 600;
      margin-bottom: 4px;
    }

    .user-detail-username {
      color: var(--text-muted);
      margin-bottom: 16px;
    }

    .user-detail-info {
      background: var(--bg-secondary);
      border-radius: var(--radius-md);
      padding: 16px;
    }

    .user-detail-row {
      display: flex;
      justify-content: space-between;
      padding: 8px 0;
      border-bottom: 1px solid var(--border-color);
    }

    .user-detail-row:last-child {
      border-bottom: none;
    }

    .user-detail-label {
      color: var(--text-secondary);
      font-size: 13px;
    }

    .user-detail-value {
      font-weight: 500;
      font-size: 13px;
    }

    /* Item Card */
    .item-card {
      display: flex;
      align-items: center;
      gap: 16px;
      padding: 16px;
      border-radius: var(--radius-md);
      background: var(--bg-secondary);
      margin-bottom: 12px;
    }

    .item-card img {
      width: 60px;
      height: 60px;
      border-radius: var(--radius-md);
      object-fit: cover;
    }

    .item-card-info {
      flex: 1;
      min-width: 0;
    }

    .item-card-title {
      font-weight: 600;
      margin-bottom: 4px;
    }

    .item-card-desc {
      font-size: 13px;
      color: var(--text-secondary);
    }

    .item-card-actions {
      display: flex;
      gap: 8px;
    }

    /* QR Scanner */
    #qr-reader {
      width: 100%;
      max-width: 400px;
      margin: 0 auto;
    }

    .qr-result {
      padding: 16px;
      border-radius: var(--radius-md);
      margin-top: 16px;
      text-align: center;
    }

    .qr-result.success {
      background: #e8f5e9;
      color: var(--success);
    }

    .qr-result.error {
      background: #fef2f2;
      color: var(--danger);
    }

    .attendance-list {
      margin-top: 20px;
    }

    .attendance-item {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 12px;
      border-radius: var(--radius-md);
      background: var(--bg-secondary);
      margin-bottom: 8px;
    }

    .attendance-item img {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      object-fit: cover;
    }

    .attendance-info {
      flex: 1;
    }

    .attendance-name {
      font-weight: 500;
    }

    .attendance-time {
      font-size: 12px;
      color: var(--text-muted);
    }

    .attendance-status {
      padding: 4px 10px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 500;
    }

    .attendance-confirmed {
      background: #e8f5e9;
      color: var(--success);
    }

    .attendance-pending {
      background: #fff3e0;
      color: #f57c00;
    }

    /* Empty State */
    .empty-state {
      text-align: center;
      padding: 60px 20px;
      color: var(--text-muted);
    }

    .empty-state i {
      font-size: 48px;
      margin-bottom: 16px;
    }

    .empty-state h3 {
      font-size: 18px;
      color: var(--text-primary);
      margin-bottom: 8px;
    }

    /* Loading */
    .loading {
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 40px;
    }

    .spinner {
      width: 40px;
      height: 40px;
      border: 3px solid var(--border-color);
      border-top-color: var(--accent);
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      to { transform: rotate(360deg); }
    }

    /* Toast */
    .toast {
      position: fixed;
      bottom: 24px;
      right: 24px;
      background: var(--accent);
      color: white;
      padding: 14px 24px;
      border-radius: var(--radius-md);
      box-shadow: var(--shadow-lg);
      z-index: 2000;
      transform: translateY(100px);
      opacity: 0;
      transition: all 0.3s;
    }

    .toast.show {
      transform: translateY(0);
      opacity: 1;
    }

    /* Responsive */
    @media (max-width: 1024px) {
      .sidebar {
        transform: translateX(-100%);
      }

      .sidebar.open {
        transform: translateX(0);
      }

      .main-content {
        margin-left: 0;
      }

      .menu-toggle {
        display: block;
      }
    }

    @media (max-width: 768px) {
      .page-content {
        padding: 16px;
      }

      .top-header {
        padding: 12px 16px;
      }

      .stats-grid {
        grid-template-columns: 1fr;
      }

      .user-detail {
        grid-template-columns: 1fr;
      }

      .user-detail-sidebar {
        margin-bottom: 16px;
      }

      .filters-bar {
        flex-direction: column;
      }

      .search-box {
        max-width: none;
        width: 100%;
      }

      .item-card {
        flex-direction: column;
        text-align: center;
      }

      .item-card-actions {
        width: 100%;
        justify-content: center;
      }
    }

    /* Overlay for mobile sidebar */
    .sidebar-overlay {
      display: none;
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,0.5);
      z-index: 99;
    }

    .sidebar-overlay.active {
      display: block;
    }
  </style>
</head>
<body>
  <!-- Login Screen -->
  <div class="login-screen" id="loginScreen">
    <div class="login-card">
      <div class="login-logo">LENG</div>
      <div class="login-subtitle">Admin Panel</div>
      <div class="login-error" id="loginError">Bu hesabin admin yetkisi bulunmuyor.</div>
      <button class="google-btn" onclick="signInWithGoogle()">
        <svg viewBox="0 0 24 24">
          <path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>
          <path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>
          <path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>
          <path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>
        </svg>
        Google ile Giris Yap
      </button>
    </div>
  </div>

  <!-- Admin Container -->
  <div class="admin-container" id="adminContainer">
    <!-- Sidebar Overlay -->
    <div class="sidebar-overlay" id="sidebarOverlay" onclick="toggleSidebar()"></div>

    <!-- Sidebar -->
    <aside class="sidebar" id="sidebar">
      <div class="sidebar-header">
        <div class="sidebar-logo">LENG</div>
        <div class="sidebar-label">Admin Panel</div>
      </div>

      <nav class="sidebar-nav">
        <div class="nav-section">
          <div class="nav-section-title">Genel</div>
          <div class="nav-item active" onclick="switchSection('dashboard')">
            <i class="ri-dashboard-line"></i>
            <span>Dashboard</span>
          </div>
        </div>

        <div class="nav-section">
          <div class="nav-section-title">Yonetim</div>
          <div class="nav-item" onclick="switchSection('users')">
            <i class="ri-user-line"></i>
            <span>Kullanicilar</span>
          </div>
          <div class="nav-item" onclick="switchSection('events')">
            <i class="ri-calendar-event-line"></i>
            <span>Etkinlikler</span>
          </div>
          <div class="nav-item" onclick="switchSection('games')">
            <i class="ri-gamepad-line"></i>
            <span>Oyunlar</span>
          </div>
          <div class="nav-item" onclick="switchSection('clubs')">
            <i class="ri-team-line"></i>
            <span>Kulupler</span>
          </div>
        </div>

        <div class="nav-section">
          <div class="nav-section-title">Araclar</div>
          <div class="nav-item" onclick="switchSection('qrscanner')">
            <i class="ri-qr-scan-line"></i>
            <span>QR Tarayici</span>
          </div>
        </div>
      </nav>

      <div class="sidebar-footer">
        <div class="admin-profile">
          <div class="admin-avatar" id="adminAvatar">A</div>
          <div class="admin-info">
            <div class="admin-name" id="adminName">Admin</div>
            <div class="admin-role">Yonetici</div>
          </div>
        </div>
      </div>
    </aside>

    <!-- Main Content -->
    <main class="main-content">
      <header class="top-header">
        <div class="header-left">
          <button class="menu-toggle" onclick="toggleSidebar()">
            <i class="ri-menu-line"></i>
          </button>
          <h1 class="page-title" id="pageTitle">Dashboard</h1>
        </div>
        <div class="header-right">
          <button class="header-btn" onclick="signOutAdmin()">
            <i class="ri-logout-box-line"></i>
          </button>
        </div>
      </header>

      <div class="page-content">
        <!-- Dashboard Section -->
        <section class="page-section active" id="dashboardSection">
          <div class="stats-grid">
            <div class="stat-card">
              <div class="stat-header">
                <div class="stat-icon users">
                  <i class="ri-user-line"></i>
                </div>
              </div>
              <div class="stat-value" id="totalUsers">0</div>
              <div class="stat-label">Toplam Kullanici</div>
            </div>
            <div class="stat-card">
              <div class="stat-header">
                <div class="stat-icon events">
                  <i class="ri-calendar-event-line"></i>
                </div>
              </div>
              <div class="stat-value" id="totalEvents">0</div>
              <div class="stat-label">Toplam Etkinlik</div>
            </div>
            <div class="stat-card">
              <div class="stat-header">
                <div class="stat-icon games">
                  <i class="ri-gamepad-line"></i>
                </div>
              </div>
              <div class="stat-value" id="totalGames">0</div>
              <div class="stat-label">Toplam Oyun</div>
            </div>
            <div class="stat-card">
              <div class="stat-header">
                <div class="stat-icon users">
                  <i class="ri-user-star-line"></i>
                </div>
              </div>
              <div class="stat-value" id="onlineUsers">0</div>
              <div class="stat-label">Cevrimici Kullanici</div>
            </div>
          </div>

          <div class="card">
            <div class="card-header">
              <h3 class="card-title">Son Kullanicilar</h3>
            </div>
            <div class="card-body" id="recentUsers">
              <div class="loading"><div class="spinner"></div></div>
            </div>
          </div>
        </section>

        <!-- Users Section -->
        <section class="page-section" id="usersSection">
          <div class="card">
            <div class="card-header">
              <h3 class="card-title">Kullanicilar</h3>
              <div class="filters-bar">
                <div class="search-box">
                  <i class="ri-search-line"></i>
                  <input type="text" placeholder="Kullanici ara..." id="userSearch" oninput="filterUsers()">
                </div>
                <select class="filter-select" id="userFilter" onchange="filterUsers()">
                  <option value="all">Tum Kullanicilar</option>
                  <option value="verified">Onaylilar</option>
                  <option value="banned">Engellilar</option>
                  <option value="online">Cevrimici</option>
                </select>
              </div>
            </div>
            <div class="table-container">
              <table class="data-table">
                <thead>
                  <tr>
                    <th>Kullanici</th>
                    <th>Kullanici Adi</th>
                    <th>E-posta</th>
                    <th>Durum</th>
                    <th>Katilim</th>
                    <th>Islemler</th>
                  </tr>
                </thead>
                <tbody id="usersTableBody">
                  <tr><td colspan="6" class="loading"><div class="spinner"></div></td></tr>
                </tbody>
              </table>
            </div>
          </div>
        </section>

        <!-- Events Section -->
        <section class="page-section" id="eventsSection">
          <div class="card">
            <div class="card-header">
              <h3 class="card-title">Etkinlikler</h3>
              <button class="btn btn-primary" onclick="showAddEventModal()">
                <i class="ri-add-line"></i> Yeni Etkinlik
              </button>
            </div>
            <div class="card-body" id="eventsList">
              <div class="loading"><div class="spinner"></div></div>
            </div>
          </div>
        </section>

        <!-- Games Section -->
        <section class="page-section" id="gamesSection">
          <div class="card">
            <div class="card-header">
              <h3 class="card-title">Oyunlar</h3>
              <button class="btn btn-primary" onclick="showAddGameModal()">
                <i class="ri-add-line"></i> Yeni Oyun
              </button>
            </div>
            <div class="card-body" id="gamesList">
              <div class="loading"><div class="spinner"></div></div>
            </div>
          </div>
        </section>

        <!-- Clubs Section -->
        <section class="page-section" id="clubsSection">
          <div class="card">
            <div class="card-header">
              <h3 class="card-title">Kulupler</h3>
              <div class="filters-bar">
                <div class="search-box">
                  <i class="ri-search-line"></i>
                  <input type="text" placeholder="Kulup ara..." id="clubSearch" oninput="filterClubs()">
                </div>
              </div>
            </div>
            <div class="card-body" id="clubsList">
              <div class="loading"><div class="spinner"></div></div>
            </div>
          </div>
        </section>

        <!-- QR Scanner Section -->
        <section class="page-section" id="qrscannerSection">
          <div class="card">
            <div class="card-header">
              <h3 class="card-title">QR Tarayici</h3>
            </div>
            <div class="card-body">
              <div class="form-group">
                <label class="form-label">Etkinlik Sec</label>
                <select class="form-input" id="qrEventSelect" onchange="onQrEventChange()">
                  <option value="">Etkinlik seciniz...</option>
                </select>
              </div>
              <div id="qr-reader"></div>
              <div class="qr-result" id="qrResult" style="display:none;">
                <div id="qrResultTitle"></div>
                <div id="qrResultText"></div>
              </div>
              <div class="attendance-list" id="attendanceList">
                <p style="text-align:center;color:var(--text-muted);padding:20px;">Etkinlik seciniz</p>
              </div>
            </div>
          </div>
        </section>
      </div>
    </main>
  </div>

  <!-- Club Detail Modal -->
  <div class="modal-overlay" id="clubDetailModal">
    <div class="modal" style="max-width:700px;">
      <div class="modal-header">
        <h3 class="modal-title">Kulup Detayi</h3>
        <button class="modal-close" onclick="closeModal('clubDetailModal')">
          <i class="ri-close-line"></i>
        </button>
      </div>
      <div class="modal-body">
        <div class="user-detail">
          <div class="user-detail-sidebar">
            <img class="user-detail-avatar" id="clubDetailAvatar" src="" alt="" style="border-radius:16px;">
            <div class="user-detail-name" id="clubDetailName">-</div>
            <div class="user-detail-username" id="clubDetailOwner">-</div>
          </div>
          <div class="user-detail-info">
            <div class="user-detail-row">
              <span class="user-detail-label">Aciklama</span>
              <span class="user-detail-value" id="clubDetailDesc">-</span>
            </div>
            <div class="user-detail-row">
              <span class="user-detail-label">Uye Sayisi</span>
              <span class="user-detail-value" id="clubDetailMembers">-</span>
            </div>
            <div class="user-detail-row">
              <span class="user-detail-label">Olusturma Tarihi</span>
              <span class="user-detail-value" id="clubDetailCreated">-</span>
            </div>
            <div class="user-detail-row">
              <span class="user-detail-label">Sohbet Rengi</span>
              <span class="user-detail-value" id="clubDetailColor">-</span>
            </div>
          </div>
        </div>
        <div style="margin-top:20px;">
          <h4 style="margin-bottom:12px;">Uyeler</h4>
          <div id="clubMembersList" style="max-height:200px;overflow-y:auto;">
            <div class="loading"><div class="spinner"></div></div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closeModal('clubDetailModal')">Kapat</button>
        <button class="btn btn-danger" id="deleteClubBtn" onclick="deleteClubAdmin()">Kulubu Sil</button>
      </div>
    </div>
  </div>

  <!-- User Detail Modal -->
  <div class="modal-overlay" id="userDetailModal">
    <div class="modal">
      <div class="modal-header">
        <h3 class="modal-title">Kullanici Detayi</h3>
        <button class="modal-close" onclick="closeModal('userDetailModal')">
          <i class="ri-close-line"></i>
        </button>
      </div>
      <div class="modal-body">
        <div class="user-detail">
          <div class="user-detail-sidebar">
            <img class="user-detail-avatar" id="userDetailAvatar" src="" alt="">
            <div class="user-detail-name" id="userDetailName">-</div>
            <div class="user-detail-username" id="userDetailUsername">-</div>
          </div>
          <div class="user-detail-info">
            <div class="user-detail-row">
              <span class="user-detail-label">E-posta</span>
              <span class="user-detail-value" id="userDetailEmail">-</span>
            </div>
            <div class="user-detail-row">
              <span class="user-detail-label">Dogum Tarihi</span>
              <span class="user-detail-value" id="userDetailBirthDate">-</span>
            </div>
            <div class="user-detail-row">
              <span class="user-detail-label">Katilim Tarihi</span>
              <span class="user-detail-value" id="userDetailJoinDate">-</span>
            </div>
            <div class="user-detail-row">
              <span class="user-detail-label">Durum</span>
              <span class="user-detail-value" id="userDetailStatus">-</span>
            </div>
            <div class="user-detail-row">
              <span class="user-detail-label">Onay</span>
              <span class="user-detail-value" id="userDetailVerified">-</span>
            </div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closeModal('userDetailModal')">Kapat</button>
        <button class="btn btn-success" id="userVerifyBtn" onclick="toggleUserVerify()">Onayla</button>
        <button class="btn btn-danger" id="userBanBtn" onclick="toggleUserBan()">Engelle</button>
      </div>
    </div>
  </div>

  <!-- Event Modal -->
  <div class="modal-overlay" id="eventModal">
    <div class="modal">
      <div class="modal-header">
        <h3 class="modal-title" id="eventModalTitle">Yeni Etkinlik</h3>
        <button class="modal-close" onclick="closeModal('eventModal')">
          <i class="ri-close-line"></i>
        </button>
      </div>
      <div class="modal-body">
        <input type="hidden" id="eventEditId">
        <div class="form-group">
          <label class="form-label">Etkinlik Adi</label>
          <input type="text" class="form-input" id="eventName" placeholder="Etkinlik adi">
        </div>
        <div class="form-group">
          <label class="form-label">Aciklama</label>
          <textarea class="form-input form-textarea" id="eventDesc" placeholder="Etkinlik aciklamasi"></textarea>
        </div>
        <div class="form-group">
          <label class="form-label">Gorsel URL</label>
          <input type="text" class="form-input" id="eventImage" placeholder="https://...">
        </div>
        <div class="form-group">
          <label class="form-label">Tarih</label>
          <input type="datetime-local" class="form-input" id="eventDate">
        </div>
        <div class="form-group">
          <label class="form-label">Konum</label>
          <input type="text" class="form-input" id="eventLocation" placeholder="Etkinlik konumu">
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closeModal('eventModal')">Iptal</button>
        <button class="btn btn-primary" onclick="saveEvent()">Kaydet</button>
      </div>
    </div>
  </div>

  <!-- Game Modal -->
  <div class="modal-overlay" id="gameModal">
    <div class="modal">
      <div class="modal-header">
        <h3 class="modal-title" id="gameModalTitle">Yeni Oyun</h3>
        <button class="modal-close" onclick="closeModal('gameModal')">
          <i class="ri-close-line"></i>
        </button>
      </div>
      <div class="modal-body">
        <input type="hidden" id="gameEditId">
        <div class="form-group">
          <label class="form-label">Oyun Adi</label>
          <input type="text" class="form-input" id="gameName" placeholder="Oyun adi">
        </div>
        <div class="form-group">
          <label class="form-label">Aciklama</label>
          <textarea class="form-input form-textarea" id="gameDesc" placeholder="Oyun aciklamasi"></textarea>
        </div>
        <div class="form-group">
          <label class="form-label">Ikon URL</label>
          <input type="text" class="form-input" id="gameIcon" placeholder="https://...">
        </div>
        <div class="form-group">
          <label class="form-label">Oyun URL</label>
          <input type="text" class="form-input" id="gameUrl" placeholder="https://...">
        </div>
      </div>
      <div class="modal-footer">
        <button class="btn btn-secondary" onclick="closeModal('gameModal')">Iptal</button>
        <button class="btn btn-primary" onclick="saveGame()">Kaydet</button>
      </div>
    </div>
  </div>

  <!-- Toast -->
  <div class="toast" id="toast"></div>

  <!-- Firebase SDK -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-app.js";
    import { 
      getAuth, 
      signInWithPopup, 
      GoogleAuthProvider, 
      onAuthStateChanged,
      signOut as firebaseSignOut 
    } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-auth.js";
    import { 
      getDatabase, 
      ref, 
      set, 
      get, 
      push, 
      onValue, 
      update,
      remove
    } from "https://www.gstatic.com/firebasejs/10.7.0/firebase-database.js";

    // Firebase Config
    const firebaseConfig = {
      apiKey: "AIzaSyCbBh9ulc4_tds31MsDbiSgaHPUU3l0Qx4",
      authDomain: "maps-52b00.firebaseapp.com",
      databaseURL: "https://maps-52b00-default-rtdb.europe-west1.firebasedatabase.app",
      projectId: "maps-52b00",
      storageBucket: "maps-52b00.firebasestorage.app",
      messagingSenderId: "485125559932",
      appId: "1:485125559932:web:7d304f3f2cda4ef4c21bf9"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getDatabase(app);
    const provider = new GoogleAuthProvider();

    let currentAdmin = null;
    let allUsers = [];
    let allEvents = [];
    let allGames = [];
    let selectedUserId = null;
    let html5QrCode = null;
    let isScanning = false;

    // ADMIN CHECK: Only allow specific email OR admins from database
    const SUPER_ADMIN_EMAIL = "m.yusufertek@gmail.com";

    // Auth State
    onAuthStateChanged(auth, async (user) => {
      if (user) {
        // Check if user is admin
        const isAdmin = await checkAdminPermission(user);
        
        if (isAdmin) {
          currentAdmin = user;
          showAdminPanel();
          loadDashboard();
          loadUsers();
          loadEvents();
          loadGames();
          updateAdminProfile();
        } else {
          // Not an admin
          document.getElementById('loginError').style.display = 'block';
          await firebaseSignOut(auth);
        }
      } else {
        currentAdmin = null;
        showLoginScreen();
      }
    });

    // Check Admin Permission
    async function checkAdminPermission(user) {
      // First check if email is super admin
      if (user.email === SUPER_ADMIN_EMAIL) {
        return true;
      }
      
      // Then check database for admins
      try {
        const adminRef = ref(db, `admins/${user.uid}`);
        const snapshot = await get(adminRef);
        return snapshot.exists() && snapshot.val() === true;
      } catch (error) {
        console.error("Admin check error:", error);
        return false;
      }
    }

    // Sign In with Google
    window.signInWithGoogle = async () => {
      try {
        document.getElementById('loginError').style.display = 'none';
        await signInWithPopup(auth, provider);
      } catch (error) {
        console.error("Login error:", error);
        showToast("Giris yapilamadi");
      }
    };

    // Sign Out
    window.signOutAdmin = async () => {
      try {
        await firebaseSignOut(auth);
      } catch (error) {
        console.error("Logout error:", error);
      }
    };

    // Show Login Screen
    function showLoginScreen() {
      document.getElementById('loginScreen').style.display = 'flex';
      document.getElementById('adminContainer').classList.remove('active');
    }

    // Show Admin Panel
    function showAdminPanel() {
      document.getElementById('loginScreen').style.display = 'none';
      document.getElementById('adminContainer').classList.add('active');
    }

    // Update Admin Profile
    function updateAdminProfile() {
      const avatarEl = document.getElementById('adminAvatar');
      const nameEl = document.getElementById('adminName');
      
      if (currentAdmin.photoURL) {
        avatarEl.innerHTML = `<img src="${currentAdmin.photoURL}" alt="">`;
      } else {
        avatarEl.textContent = currentAdmin.email.charAt(0).toUpperCase();
      }
      
      nameEl.textContent = currentAdmin.displayName || currentAdmin.email.split('@')[0];
    }

    // Toggle Sidebar
    window.toggleSidebar = () => {
      document.getElementById('sidebar').classList.toggle('open');
      document.getElementById('sidebarOverlay').classList.toggle('active');
    };

    // Switch Section
    window.switchSection = (section) => {
      document.querySelectorAll('.page-section').forEach(s => s.classList.remove('active'));
      document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active'));
      
      document.getElementById(section + 'Section').classList.add('active');
      event.currentTarget.classList.add('active');
      
      const titles = {
        'dashboard': 'Dashboard',
        'users': 'Kullanicilar',
        'events': 'Etkinlikler',
        'games': 'Oyunlar',
        'clubs': 'Kulupler',
        'qrscanner': 'QR Tarayici'
      };
      
      document.getElementById('pageTitle').textContent = titles[section] || 'Dashboard';
      
      if (section === 'clubs') {
        loadClubs();
      }
      
      if (section === 'qrscanner') {
        loadEventsForSelect('qrEventSelect');
        initQRScanner();
      }
      
      // Close sidebar on mobile
      if (window.innerWidth <= 1024) {
        document.getElementById('sidebar').classList.remove('open');
        document.getElementById('sidebarOverlay').classList.remove('active');
      }
    };

    // Load Dashboard
    function loadDashboard() {
      // Stats are updated via realtime listeners
      onValue(ref(db, 'users'), (snapshot) => {
        const users = snapshot.val() || {};
        const userCount = Object.keys(users).length;
        const onlineCount = Object.values(users).filter(u => u.online).length;
        
        document.getElementById('totalUsers').textContent = userCount;
        document.getElementById('onlineUsers').textContent = onlineCount;
        
        // Recent users
        const recentContainer = document.getElementById('recentUsers');
        const sortedUsers = Object.entries(users)
          .map(([id, user]) => ({ id, ...user }))
          .sort((a, b) => (b.createdAt || 0) - (a.createdAt || 0))
          .slice(0, 5);
        
        if (sortedUsers.length === 0) {
          recentContainer.innerHTML = '<div class="empty-state"><p>Henuz kullanici yok</p></div>';
          return;
        }
        
        let html = '';
        for (const user of sortedUsers) {
          html += `
            <div class="item-card">
              <img src="${user.photoURL || `https://ui-avatars.com/api/?name=${encodeURIComponent(user.displayName || 'U')}&background=1a1a1a&color=fff`}" alt="">
              <div class="item-card-info">
                <div class="item-card-title">${user.displayName || 'Isimsiz'}</div>
                <div class="item-card-desc">@${user.username || 'kullanici'} - ${user.email || ''}</div>
              </div>
              <span class="badge ${user.online ? 'badge-success' : 'badge-default'}">${user.online ? 'Cevrimici' : 'Cevrimdisi'}</span>
            </div>
          `;
        }
        recentContainer.innerHTML = html;
      });

      onValue(ref(db, 'events'), (snapshot) => {
        const count = snapshot.exists() ? Object.keys(snapshot.val()).length : 0;
        document.getElementById('totalEvents').textContent = count;
      });

      onValue(ref(db, 'games'), (snapshot) => {
        const count = snapshot.exists() ? Object.keys(snapshot.val()).length : 0;
        document.getElementById('totalGames').textContent = count;
      });
    }

    // Load Users
    function loadUsers() {
      onValue(ref(db, 'users'), (snapshot) => {
        allUsers = [];
        if (snapshot.exists()) {
          snapshot.forEach(child => {
            allUsers.push({ id: child.key, ...child.val() });
          });
        }
        renderUsersTable();
      });
    }

    // Render Users Table
    function renderUsersTable(users = allUsers) {
      const tbody = document.getElementById('usersTableBody');
      
      if (users.length === 0) {
        tbody.innerHTML = '<tr><td colspan="6" class="empty-state"><p>Kullanici bulunamadi</p></td></tr>';
        return;
      }
      
      let html = '';
      for (const user of users) {
        const joinDate = user.createdAt ? new Date(user.createdAt).toLocaleDateString('tr-TR') : '-';
        const statusBadge = user.banned 
          ? '<span class="badge badge-danger">Engelli</span>'
          : (user.online ? '<span class="badge badge-success">Cevrimici</span>' : '<span class="badge badge-default">Cevrimdisi</span>');
        
        html += `
          <tr>
            <td>
              <div class="user-cell">
                <img class="user-avatar" src="${user.photoURL || `https://ui-avatars.com/api/?name=${encodeURIComponent(user.displayName || 'U')}&background=1a1a1a&color=fff`}" alt="">
                <div>
                  <div class="user-name">${user.displayName || 'Isimsiz'} ${user.verified ? '<i class="ri-verified-badge-fill" style="color:#1da1f2;"></i>' : ''}</div>
                  <div class="user-email">${user.email || '-'}</div>
                </div>
              </div>
            </td>
            <td>@${user.username || '-'}</td>
            <td>${user.email || '-'}</td>
            <td>${statusBadge}</td>
            <td>${joinDate}</td>
            <td>
              <div class="action-btns">
                <button class="action-btn view" onclick="viewUserDetail('${user.id}')">
                  <i class="ri-eye-line"></i>
                </button>
                <button class="action-btn ${user.verified ? 'edit' : 'success'}" onclick="quickToggleVerify('${user.id}', ${!user.verified})">
                  <i class="ri-${user.verified ? 'close-line' : 'check-line'}"></i>
                </button>
                <button class="action-btn delete" onclick="quickToggleBan('${user.id}', ${!user.banned})">
                  <i class="ri-${user.banned ? 'lock-unlock-line' : 'forbid-line'}"></i>
                </button>
              </div>
            </td>
          </tr>
        `;
      }
      tbody.innerHTML = html;
    }

    // Filter Users
    window.filterUsers = () => {
      const search = document.getElementById('userSearch').value.toLowerCase();
      const filter = document.getElementById('userFilter').value;
      
      let filtered = allUsers;
      
      if (search) {
        filtered = filtered.filter(u => 
          (u.displayName && u.displayName.toLowerCase().includes(search)) ||
          (u.username && u.username.toLowerCase().includes(search)) ||
          (u.email && u.email.toLowerCase().includes(search))
        );
      }
      
      if (filter === 'verified') {
        filtered = filtered.filter(u => u.verified);
      } else if (filter === 'banned') {
        filtered = filtered.filter(u => u.banned);
      } else if (filter === 'online') {
        filtered = filtered.filter(u => u.online);
      }
      
      renderUsersTable(filtered);
    };

    // View User Detail
    window.viewUserDetail = (userId) => {
      selectedUserId = userId;
      const user = allUsers.find(u => u.id === userId);
      if (!user) return;
      
      document.getElementById('userDetailAvatar').src = user.photoURL || `https://ui-avatars.com/api/?name=${encodeURIComponent(user.displayName || 'U')}&background=1a1a1a&color=fff`;
      document.getElementById('userDetailName').textContent = user.displayName || 'Isimsiz';
      document.getElementById('userDetailUsername').textContent = '@' + (user.username || 'kullanici');
      document.getElementById('userDetailEmail').textContent = user.email || '-';
      document.getElementById('userDetailBirthDate').textContent = user.birthDate || '-';
      document.getElementById('userDetailJoinDate').textContent = user.createdAt ? new Date(user.createdAt).toLocaleDateString('tr-TR') : '-';
      document.getElementById('userDetailStatus').innerHTML = user.banned 
        ? '<span class="badge badge-danger">Engelli</span>' 
        : (user.online ? '<span class="badge badge-success">Cevrimici</span>' : '<span class="badge badge-default">Cevrimdisi</span>');
      document.getElementById('userDetailVerified').innerHTML = user.verified 
        ? '<span class="badge badge-info">Onaylanmis</span>' 
        : '<span class="badge badge-default">Onaysiz</span>';
      
      document.getElementById('userVerifyBtn').textContent = user.verified ? 'Onayi Kaldir' : 'Onayla';
      document.getElementById('userBanBtn').textContent = user.banned ? 'Engeli Kaldir' : 'Engelle';
      
      document.getElementById('userDetailModal').classList.add('active');
    };

    // Toggle User Verify
    window.toggleUserVerify = async () => {
      if (!selectedUserId) return;
      const user = allUsers.find(u => u.id === selectedUserId);
      if (!user) return;
      
      try {
        await update(ref(db, `users/${selectedUserId}`), {
          verified: !user.verified
        });
        showToast(user.verified ? 'Onay kaldirildi' : 'Kullanici onaylandi');
        closeModal('userDetailModal');
      } catch (error) {
        showToast('Hata: ' + error.message);
      }
    };

    // Toggle User Ban
    window.toggleUserBan = async () => {
      if (!selectedUserId) return;
      const user = allUsers.find(u => u.id === selectedUserId);
      if (!user) return;
      
      try {
        const newBannedStatus = !user.banned;
        await update(ref(db, `users/${selectedUserId}`), {
          banned: newBannedStatus
        });
        
        // If banning user, force logout by setting forceLogout flag
        if (newBannedStatus) {
          await set(ref(db, `forceLogout/${selectedUserId}`), {
            timestamp: Date.now(),
            reason: 'banned'
          });
        }
        
        showToast(user.banned ? 'Engel kaldirildi' : 'Kullanici engellendi');
        closeModal('userDetailModal');
      } catch (error) {
        showToast('Hata: ' + error.message);
      }
    };

    // Quick Toggle Verify
    window.quickToggleVerify = async (userId, newStatus) => {
      try {
        await update(ref(db, `users/${userId}`), {
          verified: newStatus
        });
        showToast(newStatus ? 'Kullanici onaylandi' : 'Onay kaldirildi');
      } catch (error) {
        showToast('Hata: ' + error.message);
      }
    };

    // Quick Toggle Ban
    window.quickToggleBan = async (userId, newStatus) => {
      try {
        await update(ref(db, `users/${userId}`), {
          banned: newStatus
        });
        
        // If banning, force logout
        if (newStatus) {
          await set(ref(db, `forceLogout/${userId}`), {
            timestamp: Date.now(),
            reason: 'banned'
          });
        }
        
        showToast(newStatus ? 'Kullanici engellendi' : 'Engel kaldirildi');
      } catch (error) {
        showToast('Hata: ' + error.message);
      }
    };

    // Load Events
    function loadEvents() {
      onValue(ref(db, 'events'), (snapshot) => {
        allEvents = [];
        let html = '';
        if (snapshot.exists()) {
          snapshot.forEach(child => {
            const event = { id: child.key, ...child.val() };
            allEvents.push(event);
            const date = event.date ? new Date(event.date).toLocaleDateString('tr-TR') : 'Tarih yok';
            html += `
              <div class="item-card">
                <img src="${event.image || 'https://via.placeholder.com/60/1a1a1a/666?text=E'}" alt="${event.name}">
                <div class="item-card-info">
                  <div class="item-card-title">${event.name}</div>
                  <div class="item-card-desc">${date} - ${event.location || 'Konum yok'}</div>
                </div>
                <div class="item-card-actions">
                  <button class="btn btn-sm btn-secondary" onclick="editEvent('${event.id}')">Duzenle</button>
                  <button class="btn btn-sm btn-danger" onclick="deleteEvent('${event.id}')">Sil</button>
                </div>
              </div>
            `;
          });
        }
        document.getElementById('eventsList').innerHTML = html || '<p style="text-align:center;color:var(--text-muted);padding:20px;">Etkinlik bulunamadi</p>';
      });
    }

    function loadEventsForSelect(selectId) {
      const select = document.getElementById(selectId);
      select.innerHTML = '<option value="">Etkinlik seciniz...</option>';
      allEvents.forEach(event => {
        select.innerHTML += `<option value="${event.id}">${event.name}</option>`;
      });
    }

    window.showAddEventModal = () => {
      document.getElementById('eventModalTitle').textContent = 'Yeni Etkinlik';
      document.getElementById('eventEditId').value = '';
      document.getElementById('eventName').value = '';
      document.getElementById('eventDesc').value = '';
      document.getElementById('eventImage').value = '';
      document.getElementById('eventDate').value = '';
      document.getElementById('eventLocation').value = '';
      document.getElementById('eventModal').classList.add('active');
    };

    window.editEvent = async (eventId) => {
      const snapshot = await get(ref(db, `events/${eventId}`));
      if (snapshot.exists()) {
        const event = snapshot.val();
        document.getElementById('eventModalTitle').textContent = 'Etkinlik Duzenle';
        document.getElementById('eventEditId').value = eventId;
        document.getElementById('eventName').value = event.name || '';
        document.getElementById('eventDesc').value = event.description || '';
        document.getElementById('eventImage').value = event.image || '';
        document.getElementById('eventDate').value = event.date || '';
        document.getElementById('eventLocation').value = event.location || '';
        document.getElementById('eventModal').classList.add('active');
      }
    };

    window.saveEvent = async () => {
      const eventId = document.getElementById('eventEditId').value;
      const name = document.getElementById('eventName').value.trim();
      const description = document.getElementById('eventDesc').value.trim();
      const image = document.getElementById('eventImage').value.trim();
      const date = document.getElementById('eventDate').value;
      const location = document.getElementById('eventLocation').value.trim();

      if (!name) {
        showToast('Etkinlik adi gerekli!');
        return;
      }

      const eventData = { name, description, image, date, location };

      try {
        if (eventId) {
          await update(ref(db, `events/${eventId}`), eventData);
        } else {
          await push(ref(db, 'events'), eventData);
        }
        closeModal('eventModal');
        showToast('Etkinlik kaydedildi');
      } catch (error) {
        showToast('Hata: ' + error.message);
      }
    };

    window.deleteEvent = async (eventId) => {
      if (confirm('Bu etkinligi silmek istediginize emin misiniz?')) {
        try {
          await remove(ref(db, `events/${eventId}`));
          showToast('Etkinlik silindi');
        } catch (error) {
          showToast('Hata: ' + error.message);
        }
      }
    };

    // Load Games
    function loadGames() {
      onValue(ref(db, 'games'), (snapshot) => {
        allGames = [];
        let html = '';
        if (snapshot.exists()) {
          snapshot.forEach(child => {
            const game = { id: child.key, ...child.val() };
            allGames.push(game);
            html += `
              <div class="item-card">
                <img src="${game.icon || game.iconUrl || 'https://via.placeholder.com/60/1a1a1a/666?text=G'}" alt="${game.name}">
                <div class="item-card-info">
                  <div class="item-card-title">${game.name}</div>
                  <div class="item-card-desc">${game.description || 'Aciklama yok'}</div>
                </div>
                <div class="item-card-actions">
                  <button class="btn btn-sm btn-secondary" onclick="editGame('${game.id}')">Duzenle</button>
                  <button class="btn btn-sm btn-danger" onclick="deleteGame('${game.id}')">Sil</button>
                </div>
              </div>
            `;
          });
        }
        document.getElementById('gamesList').innerHTML = html || '<p style="text-align:center;color:var(--text-muted);padding:20px;">Oyun bulunamadi</p>';
      });
    }

    window.showAddGameModal = () => {
      document.getElementById('gameModalTitle').textContent = 'Yeni Oyun';
      document.getElementById('gameEditId').value = '';
      document.getElementById('gameName').value = '';
      document.getElementById('gameDesc').value = '';
      document.getElementById('gameIcon').value = '';
      document.getElementById('gameUrl').value = '';
      document.getElementById('gameModal').classList.add('active');
    };

    window.editGame = async (gameId) => {
      const snapshot = await get(ref(db, `games/${gameId}`));
      if (snapshot.exists()) {
        const game = snapshot.val();
        document.getElementById('gameModalTitle').textContent = 'Oyun Duzenle';
        document.getElementById('gameEditId').value = gameId;
        document.getElementById('gameName').value = game.name || '';
        document.getElementById('gameDesc').value = game.description || '';
        document.getElementById('gameIcon').value = game.icon || game.iconUrl || '';
        document.getElementById('gameUrl').value = game.url || '';
        document.getElementById('gameModal').classList.add('active');
      }
    };

    window.saveGame = async () => {
      const gameId = document.getElementById('gameEditId').value;
      const name = document.getElementById('gameName').value.trim();
      const description = document.getElementById('gameDesc').value.trim();
      const icon = document.getElementById('gameIcon').value.trim();
      const url = document.getElementById('gameUrl').value.trim();

      if (!name) {
        showToast('Oyun adi gerekli!');
        return;
      }

      const gameData = { name, description, icon, iconUrl: icon, url };

      try {
        if (gameId) {
          await update(ref(db, `games/${gameId}`), gameData);
        } else {
          await push(ref(db, 'games'), gameData);
        }
        closeModal('gameModal');
        showToast('Oyun kaydedildi');
      } catch (error) {
        showToast('Hata: ' + error.message);
      }
    };

    window.deleteGame = async (gameId) => {
      if (confirm('Bu oyunu silmek istediginize emin misiniz?')) {
        try {
          await remove(ref(db, `games/${gameId}`));
          showToast('Oyun silindi');
        } catch (error) {
          showToast('Hata: ' + error.message);
        }
      }
    };

    // QR Scanner
    function initQRScanner() {
      if (!html5QrCode) {
        html5QrCode = new Html5Qrcode("qr-reader");
      }
    }

    window.onQrEventChange = () => {
      const eventId = document.getElementById('qrEventSelect').value;
      if (eventId) {
        loadAttendanceList(eventId);
        startScanning(eventId);
      } else {
        document.getElementById('attendanceList').innerHTML = '<p style="text-align:center;color:var(--text-muted);padding:20px;">Etkinlik seciniz</p>';
        stopScanning();
      }
    };

    async function startScanning(eventId) {
      if (isScanning) {
        await stopScanning();
      }

      try {
        await html5QrCode.start(
          { facingMode: "environment" },
          {
            fps: 10,
            qrbox: { width: 250, height: 250 }
          },
          (decodedText) => {
            processQRCode(decodedText, eventId);
          },
          (errorMessage) => {}
        );
        isScanning = true;
      } catch (error) {
        console.error('QR Scanner error:', error);
      }
    }

    async function stopScanning() {
      if (html5QrCode && isScanning) {
        try {
          await html5QrCode.stop();
          isScanning = false;
        } catch (e) {}
      }
    }

    async function processQRCode(qrData, eventId) {
      const resultDiv = document.getElementById('qrResult');
      const titleEl = document.getElementById('qrResultTitle');
      const textEl = document.getElementById('qrResultText');

      try {
        const parts = qrData.split(':');
        if (parts.length !== 3) {
          throw new Error('Gecersiz QR kod formati');
        }

        const [userId, timestamp, code] = parts;
        const qrTime = parseInt(timestamp);
        const now = Date.now();

        // QR codes are valid for 30 seconds
        if (now - qrTime > 30000) {
          throw new Error('QR kod suresi dolmus (30 saniye)');
        }

        const participantSnap = await get(ref(db, `eventParticipants/${eventId}/${userId}`));
        if (!participantSnap.exists()) {
          throw new Error('Bu kullanici etkinlige kayitli degil');
        }

        await update(ref(db, `eventParticipants/${eventId}/${userId}`), {
          attended: true,
          attendedAt: now
        });

        const userSnap = await get(ref(db, `users/${userId}`));
        const user = userSnap.exists() ? userSnap.val() : { displayName: 'Bilinmiyor' };

        resultDiv.className = 'qr-result success';
        resultDiv.style.display = 'block';
        titleEl.textContent = 'Basarili!';
        textEl.textContent = `${user.displayName} etkinlige giris yapti.`;

        loadAttendanceList(eventId);

      } catch (error) {
        resultDiv.className = 'qr-result error';
        resultDiv.style.display = 'block';
        titleEl.textContent = 'Hata!';
        textEl.textContent = error.message;
      }

      setTimeout(() => {
        resultDiv.style.display = 'none';
      }, 3000);
    }

    async function loadAttendanceList(eventId) {
      const listDiv = document.getElementById('attendanceList');
      
      const snapshot = await get(ref(db, `eventParticipants/${eventId}`));
      let html = '';
      
      if (snapshot.exists()) {
        for (const [userId, data] of Object.entries(snapshot.val())) {
          const userSnap = await get(ref(db, `users/${userId}`));
          if (userSnap.exists()) {
            const user = userSnap.val();
            html += `
              <div class="attendance-item">
                <img src="${user.photoURL || `https://ui-avatars.com/api/?name=${encodeURIComponent(user.displayName || 'U')}&background=1a1a1a&color=fff`}" alt="${user.displayName}">
                <div class="attendance-info">
                  <div class="attendance-name">${user.displayName}</div>
                  <div class="attendance-time">${data.attendedAt ? new Date(data.attendedAt).toLocaleTimeString('tr-TR') : 'Bekliyor'}</div>
                </div>
                <span class="attendance-status ${data.attended ? 'attendance-confirmed' : 'attendance-pending'}">
                  ${data.attended ? 'Katildi' : 'Bekliyor'}
                </span>
              </div>
            `;
          }
        }
      }
      
      listDiv.innerHTML = html || '<p style="text-align:center;color:var(--text-muted);padding:20px;">Katilimci bulunamadi</p>';
    }

    // Modal
    window.closeModal = (modalId) => {
      document.getElementById(modalId).classList.remove('active');
    };

    // =====================
    // CLUBS MANAGEMENT
    // =====================
    let allClubs = [];
    let selectedClubId = null;

    // Load Clubs
    function loadClubs() {
      onValue(ref(db, 'clubs'), async (snapshot) => {
        allClubs = [];
        let html = '';
        
        if (snapshot.exists()) {
          for (const [clubId, club] of Object.entries(snapshot.val())) {
            const memberSnap = await get(ref(db, `clubMembers/${clubId}`));
            const memberCount = memberSnap.exists() ? Object.keys(memberSnap.val()).length : 0;
            
            // Get owner info
            const ownerSnap = await get(ref(db, `users/${club.ownerId}`));
            const owner = ownerSnap.exists() ? ownerSnap.val() : { displayName: 'Bilinmiyor' };
            
            allClubs.push({ id: clubId, ...club, memberCount, ownerName: owner.displayName });
            
            html += `
              <div class="item-card">
                <img src="${club.image || 'https://ui-avatars.com/api/?name=' + encodeURIComponent(club.name) + '&background=9c27b0&color=fff'}" alt="${club.name}" style="border-radius:12px;">
                <div class="item-card-info">
                  <div class="item-card-title">${club.name}</div>
                  <div class="item-card-desc">Sahip: ${owner.displayName} - ${memberCount} uye</div>
                </div>
                <div class="item-card-actions">
                  <button class="btn btn-sm btn-secondary" onclick="viewClubDetail('${clubId}')">Detay</button>
                  <button class="btn btn-sm btn-danger" onclick="deleteClubDirect('${clubId}')">Sil</button>
                </div>
              </div>
            `;
          }
        }
        
        document.getElementById('clubsList').innerHTML = html || '<p style="text-align:center;color:var(--text-muted);padding:20px;">Kulup bulunamadi</p>';
      }, { onlyOnce: true });
    }

    // Filter Clubs
    window.filterClubs = () => {
      const search = document.getElementById('clubSearch').value.toLowerCase();
      const container = document.getElementById('clubsList');
      
      if (!search) {
        loadClubs();
        return;
      }
      
      const filtered = allClubs.filter(c => 
        c.name.toLowerCase().includes(search) ||
        (c.description && c.description.toLowerCase().includes(search)) ||
        c.ownerName.toLowerCase().includes(search)
      );
      
      if (filtered.length === 0) {
        container.innerHTML = '<p style="text-align:center;color:var(--text-muted);padding:20px;">Kulup bulunamadi</p>';
        return;
      }
      
      let html = '';
      for (const club of filtered) {
        html += `
          <div class="item-card">
            <img src="${club.image || 'https://ui-avatars.com/api/?name=' + encodeURIComponent(club.name) + '&background=9c27b0&color=fff'}" alt="${club.name}" style="border-radius:12px;">
            <div class="item-card-info">
              <div class="item-card-title">${club.name}</div>
              <div class="item-card-desc">Sahip: ${club.ownerName} - ${club.memberCount} uye</div>
            </div>
            <div class="item-card-actions">
              <button class="btn btn-sm btn-secondary" onclick="viewClubDetail('${club.id}')">Detay</button>
              <button class="btn btn-sm btn-danger" onclick="deleteClubDirect('${club.id}')">Sil</button>
            </div>
          </div>
        `;
      }
      container.innerHTML = html;
    };

    // View Club Detail
    window.viewClubDetail = async (clubId) => {
      selectedClubId = clubId;
      
      const clubSnap = await get(ref(db, `clubs/${clubId}`));
      if (!clubSnap.exists()) {
        showToast('Kulup bulunamadi');
        return;
      }
      
      const club = clubSnap.val();
      
      // Get owner info
      const ownerSnap = await get(ref(db, `users/${club.ownerId}`));
      const owner = ownerSnap.exists() ? ownerSnap.val() : { displayName: 'Bilinmiyor' };
      
      // Get member count
      const memberSnap = await get(ref(db, `clubMembers/${clubId}`));
      const memberCount = memberSnap.exists() ? Object.keys(memberSnap.val()).length : 0;
      
      document.getElementById('clubDetailAvatar').src = club.image || 'https://ui-avatars.com/api/?name=' + encodeURIComponent(club.name) + '&background=9c27b0&color=fff';
      document.getElementById('clubDetailName').textContent = club.name;
      document.getElementById('clubDetailOwner').textContent = 'Sahip: ' + owner.displayName;
      document.getElementById('clubDetailDesc').textContent = club.description || 'Aciklama yok';
      document.getElementById('clubDetailMembers').textContent = memberCount + ' uye';
      document.getElementById('clubDetailCreated').textContent = club.createdAt ? new Date(club.createdAt).toLocaleDateString('tr-TR') : '-';
      document.getElementById('clubDetailColor').innerHTML = `<span style="display:inline-block;width:20px;height:20px;border-radius:4px;background:${club.chatColor || '#3b82f6'};vertical-align:middle;"></span> ${club.chatColor || '#3b82f6'}`;
      
      // Load members
      let membersHtml = '';
      if (memberSnap.exists()) {
        for (const [userId, data] of Object.entries(memberSnap.val())) {
          const userSnap = await get(ref(db, `users/${userId}`));
          if (userSnap.exists()) {
            const user = userSnap.val();
            const isOwner = userId === club.ownerId;
            const isAdmin = data.role === 'admin';
            
            let roleBadge = '';
            if (isOwner) roleBadge = '<span class="badge badge-warning">Sahip</span>';
            else if (isAdmin) roleBadge = '<span class="badge badge-info">Yonetici</span>';
            else roleBadge = '<span class="badge badge-default">Uye</span>';
            
            membersHtml += `
              <div class="item-card" style="padding:10px;margin-bottom:8px;">
                <img src="${user.photoURL || 'https://ui-avatars.com/api/?name=U'}" alt="" style="width:36px;height:36px;border-radius:50%;">
                <div class="item-card-info">
                  <div class="item-card-title" style="font-size:13px;">${user.displayName}</div>
                  <div class="item-card-desc" style="font-size:11px;">@${user.username}</div>
                </div>
                ${roleBadge}
              </div>
            `;
          }
        }
      }
      document.getElementById('clubMembersList').innerHTML = membersHtml || '<p style="color:var(--text-muted);">Uye yok</p>';
      
      document.getElementById('clubDetailModal').classList.add('active');
    };

    // Delete Club (from modal)
    window.deleteClubAdmin = async () => {
      if (!selectedClubId) return;
      if (!confirm('Bu kulubu silmek istediginize emin misiniz? Tum veriler silinecek!')) return;
      
      try {
        // Remove all member badges
        const memberSnap = await get(ref(db, `clubMembers/${selectedClubId}`));
        if (memberSnap.exists()) {
          for (const userId of Object.keys(memberSnap.val())) {
            await remove(ref(db, `userBadges/${userId}/${selectedClubId}`));
          }
        }
        
        await remove(ref(db, `clubs/${selectedClubId}`));
        await remove(ref(db, `clubMembers/${selectedClubId}`));
        await remove(ref(db, `clubMessages/${selectedClubId}`));
        
        showToast('Kulup silindi');
        closeModal('clubDetailModal');
        loadClubs();
      } catch (error) {
        showToast('Hata: ' + error.message);
      }
    };

    // Delete Club Directly
    window.deleteClubDirect = async (clubId) => {
      if (!confirm('Bu kulubu silmek istediginize emin misiniz?')) return;
      
      try {
        const memberSnap = await get(ref(db, `clubMembers/${clubId}`));
        if (memberSnap.exists()) {
          for (const userId of Object.keys(memberSnap.val())) {
            await remove(ref(db, `userBadges/${userId}/${clubId}`));
          }
        }
        
        await remove(ref(db, `clubs/${clubId}`));
        await remove(ref(db, `clubMembers/${clubId}`));
        await remove(ref(db, `clubMessages/${clubId}`));
        
        showToast('Kulup silindi');
        loadClubs();
      } catch (error) {
        showToast('Hata: ' + error.message);
      }
    };
    
    // Toast
    function showToast(message) {
      const toast = document.getElementById('toast');
      toast.textContent = message;
      toast.classList.add('show');
      
      setTimeout(() => {
        toast.classList.remove('show');
      }, 3000);
    }

    // Close modals on overlay click
    document.querySelectorAll('.modal-overlay').forEach(overlay => {
      overlay.addEventListener('click', (e) => {
        if (e.target === overlay) {
          overlay.classList.remove('active');
        }
      });
    });
  </script>
</body>
</html>
